<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-key="title">GeoReady Pro | منصة التدريب الجيولوجي الشاملة للمحترفين</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght300;400;600;700;900&family=Tajawal:wght400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style>
    /* ================================= المتغيرات العامة ================================= */
    :root {
      --primary-blue: #0056b3;
      --secondary-blue: #007bff;
      --accent-cyan: #17a2b8;
      --success-green: #28a745;
      --warning-orange: #fd7e14;
      --danger-red: #dc3545;
      --dark-navy: #1a1d29;
      --light-gray: #f8f9fa;
      --white: #ffffff;
      --gradient-primary: linear-gradient(135deg, #0056b3 0%, #007bff 100%); /* Blue Gradient */
      --gradient-secondary: linear-gradient(135deg, #17a2b8 0%, #28a745 100%); /* Teal to Green Gradient */
      --shadow-soft: 0 8px 30px rgba(0,0,0,0.08);
      --shadow-medium: 0 15px 45px rgba(0,0,0,0.15);
      --shadow-strong: 0 20px 60px rgba(0,0,0,0.25);
    }

    /* ================================= التنسيقات العامة ================================= */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Cairo', 'Tajawal', sans-serif;
      line-height: 1.6;
      color: var(--dark-navy);
      background: var(--light-gray);
      overflow-x: hidden;
      transition: background-color 0.3s;
    }

    body[dir="rtl"] { text-align: right; }
    body[dir="ltr"] { text-align: left; }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* ================================= الهيدر والتنقل ================================= */
    header {
      background: var(--gradient-primary);
      color: var(--white);
      padding: 100px 0 80px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hero-title {
      font-size: 4.5rem;
      font-weight: 900;
      margin-bottom: 20px;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
      animation: fadeInUp 1s ease-out;
    }

    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 700;
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .btn-primary {
      background: var(--white);
      color: var(--primary-blue);
      box-shadow: var(--shadow-soft);
    }

    .btn-primary:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: var(--shadow-medium);
    }
    
    .btn-success {
      background: var(--success-green);
      color: var(--white);
    }

    /* ================================= شريط التنقل الثابت ================================= */
    .navbar {
      background: var(--white);
      padding: 20px 0;
      box-shadow: var(--shadow-soft);
      position: sticky;
      top: 0;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .nav-links a:hover, .nav-links a.active {
      background: var(--primary-blue);
      color: var(--white);
    }

    /* ================================= شارة النقاط ================================= */
    .score-badge {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--gradient-secondary);
      color: var(--white);
      padding: 10px 20px;
      border-radius: 25px;
      box-shadow: var(--shadow-medium);
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.1rem;
    }

    /* ================================= لوحة القيادة (المستويات) ================================= */
    .progress-section {
      background: var(--dark-navy);
      padding: 50px;
      border-radius: 25px;
      color: var(--white);
      text-align: center;
    }

    .level-badge {
      background: rgba(255,255,255,0.2);
      padding: 20px 30px;
      border-radius: 15px;
      backdrop-filter: blur(5px);
    }

    .progress-fill {
      height: 100%;
      background: var(--success-green);
      border-radius: 10px;
      transition: width 0.8s ease-in-out;
      position: relative;
    }

    .level-up-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: var(--warning-orange);
      color: var(--white);
      padding: 50px;
      border-radius: 30px;
      box-shadow: var(--shadow-strong);
      z-index: 4000;
      opacity: 0;
      transition: all 0.5s ease;
      text-align: center;
    }
    .level-up-popup.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    
    /* ================================= نظام الاختبارات المصحح ================================= */
    .test-container {
      background: var(--white);
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 30px;
    }

    .test-option {
      padding: 15px;
      margin-bottom: 10px;
      border: 2px solid #eee;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .test-option:hover {
      background: var(--light-gray);
    }

    .test-option.selected {
      border-color: var(--primary-blue);
      background: rgba(0, 86, 179, 0.05);
    }
    
    .test-option.correct {
      background-color: #d4edda;
      border-color: var(--success-green);
    }

    .test-option.wrong {
      background-color: #f8d7da;
      border-color: var(--danger-red);
    }
    
    .feedback-icon {
      position: absolute;
      top: 50%;
      left: 10px; /* لغة عربية */
      transform: translateY(-50%);
      font-size: 1.2rem;
    }
    
    /* ================================= مكونات المساعدة البوت (GeoBot) ================================= */
    .qa-modal {
      /* ... تنسيقات سابقة ... */
    }
    
    .qa-container {
      /* ... تنسيقات سابقة ... */
    }

    .qa-body {
      padding: 30px;
      flex: 1;
      overflow-y: auto;
    }

    .chat-box {
      border: 1px solid #ddd;
      height: 400px;
      overflow-y: auto;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 10px;
      background: var(--light-gray);
    }

    .chat-message {
      display: flex;
      margin-bottom: 15px;
    }

    .chat-user {
      justify-content: flex-end;
    }

    .chat-bot {
      justify-content: flex-start;
    }

    .message-bubble {
      max-width: 70%;
      padding: 10px 15px;
      border-radius: 18px;
      line-height: 1.5;
    }

    .chat-user .message-bubble {
      background: var(--primary-blue);
      color: var(--white);
      border-bottom-left-radius: 0;
    }

    .chat-bot .message-bubble {
      background: var(--white);
      color: var(--dark-navy);
      border: 1px solid #eee;
      border-bottom-right-radius: 0;
    }
    
    .input-group {
      display: flex;
      gap: 10px;
    }

    .input-group input {
      flex-grow: 1;
      padding: 12px 20px;
      border: 2px solid #eee;
      border-radius: 50px;
      font-size: 1rem;
    }

    .input-group button {
      flex-shrink: 0;
      border-radius: 50px;
    }
    
    /* ================================= تحسينات العرض التشويقية ================================= */
    .interactive-section {
      background: var(--dark-navy);
      color: var(--white);
      padding: 100px 0;
    }

    .modern-card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .feature-icon {
      background: var(--gradient-secondary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 3.5rem;
    }
    
    .tab-header {
      background: var(--gradient-secondary);
    }
    
    .tab-btn.active {
      background: rgba(0,0,0,0.2);
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    
    /* ================================= باقي التنسيقات (مختصرة لعدم التكرار) ================================= */
    /* ... (CSS for navbar, score-badge, footer, etc. from the previous code remains the same) ... */
    /* لغة LTR */
    body[dir="ltr"] .score-badge {
      left: auto;
      right: 20px;
    }

    body[dir="ltr"] .language-switcher {
      right: auto;
      left: 20px;
    }

    body[dir="ltr"] .undo-redo-container {
      left: auto;
      right: 20px;
    }

    body[dir="ltr"] .qa-modal {
      /* تصحيح اتجاه الأيقونة في وضع LTR */
    }

    body[dir="ltr"] .feedback-icon {
      left: auto;
      right: 10px;
    }
  </style>
  <script>
    // ================================= قاموس ترجمة بسيط (للتحدي) =================================
    const translations = {
        'ar': {
            'title': 'GeoReady Pro | منصة التدريب الجيولوجي الشاملة للمحترفين',
            'heroTitle': '🌍 GeoReady Pro',
            'heroSubtitle': 'منصة التدريب الجيولوجي المتكاملة | من الجامعة إلى سوق العمل',
            'startJourney': 'ابدأ رحلتك المهنية',
            'explorePaths': 'استكشف المسارات',
            'qaCenter': 'مركز الأسئلة (GeoBot)',
            'dashboard': 'لوحة القيادة',
            'learningPaths': 'مسارات التعلم',
            'interactiveTools': 'الأدوات التفاعلية',
            'certificates': 'الشهادات',
            'community': 'المجتمع',
            'score': 'نقاط',
            'totalPoints': 'نقاط الخبرة الكلية (XP)',
            'currentLevel': 'المستوى الحالي',
            'completedModules': 'وحدة مكتملة',
            'earnedCerts': 'شهادة محققة',
            'levelUp': 'تهانينا! لقد وصلت إلى المستوى',
            'level1': '01 - مبتدئ',
            'level2': '02 - متدرب',
            'nextLevelXP': 'التقدم المطلوب',
            'pathPetroleum': 'مسار جيولوجيا البترول المتقدم',
            'pathMining': 'مسار التعدين والموارد المعدنية',
            'quizTitle': 'اختبار أساسيات جيولوجيا البترول',
            'quizQuestion1': 'ما هي الصخور المصدر الرئيسية للنفط؟',
            'quizOption1_1': 'الصخور النارية',
            'quizOption1_2': 'الصخور الرسوبية الغنية بالمواد العضوية',
            'quizOption1_3': 'الصخور المتحولة',
            'quizOption1_4': 'جميع أنواع الصخور',
            'submitAnswer': 'إرسال الإجابة والتحقق',
            'correctAnswer': 'إجابة صحيحة! (+{points} XP)',
            'wrongAnswer': 'إجابة خاطئة. الإجابة الصحيحة تم تحديدها باللون الأخضر.',
            'selectAnswer': 'يرجى اختيار إجابة قبل الإرسال',
            'geobotTitle': '🤖 GeoBot: مساعدك الذكي',
            'askGeobot': 'اسأل GeoBot أي معلومة في الموقع...',
            'send': 'إرسال',
            'geobotWelcome': 'مرحباً بك! أنا GeoBot، مساعدك الذكي. يمكنك سؤالي عن أي جزء في هذه المنصة.',
            'geobotResponsePrefix': 'أهلاً! بناءً على سؤالك، إليك بعض المعلومات المتعلقة بـ "{query}": '
        },
        'en': {
            'title': 'GeoReady Pro | Comprehensive Geological Training Platform for Professionals',
            'heroTitle': '🌍 GeoReady Pro',
            'heroSubtitle': 'Integrated Geological Training Platform | From University to Job Market',
            'startJourney': 'Start Your Career Journey',
            'explorePaths': 'Explore Paths',
            'qaCenter': 'Q&A Center (GeoBot)',
            'dashboard': 'Dashboard',
            'learningPaths': 'Learning Paths',
            'interactiveTools': 'Interactive Tools',
            'certificates': 'Certificates',
            'community': 'Community',
            'score': 'Points',
            'totalPoints': 'Total Experience Points (XP)',
            'currentLevel': 'Current Level',
            'completedModules': 'Completed Modules',
            'earnedCerts': 'Certificates Earned',
            'levelUp': 'Congratulations! You Reached Level',
            'level1': '01 - Beginner',
            'level2': '02 - Intern',
            'nextLevelXP': 'XP Required',
            'pathPetroleum': 'Advanced Petroleum Geology Track',
            'pathMining': 'Mining and Mineral Resources Track',
            'quizTitle': 'Petroleum Geology Fundamentals Quiz',
            'quizQuestion1': 'What are the main source rocks for oil?',
            'quizOption1_1': 'Igneous rocks',
            'quizOption1_2': 'Sedimentary rocks rich in organic matter',
            'quizOption1_3': 'Metamorphic rocks',
            'quizOption1_4': 'All rock types',
            'submitAnswer': 'Submit Answer and Check',
            'correctAnswer': 'Correct Answer! (+{points} XP)',
            'wrongAnswer': 'Wrong Answer. The correct answer is highlighted in green.',
            'selectAnswer': 'Please select an answer before submitting',
            'geobotTitle': '🤖 GeoBot: Your Smart Assistant',
            'askGeobot': 'Ask GeoBot any info about the site...',
            'send': 'Send',
            'geobotWelcome': 'Welcome! I am GeoBot, your smart assistant. You can ask me about any part of this platform.',
            'geobotResponsePrefix': 'Hello! Based on your question, here is some information about "{query}": '
        },
        'fr': {
            'title': 'GeoReady Pro | Plateforme Complète de Formation Géologique pour Professionnels',
            'heroTitle': '🌍 GeoReady Pro',
            'heroSubtitle': 'Plateforme Intégrée de Formation Géologique | De l\'Université au Marché du Travail',
            'startJourney': 'Commencez Votre Parcours',
            'explorePaths': 'Explorez les Filières',
            'qaCenter': 'Centre Q&A (GeoBot)',
            'dashboard': 'Tableau de Bord',
            'learningPaths': 'Filières d\'Apprentissage',
            'interactiveTools': 'Outils Interactifs',
            'certificates': 'Certificats',
            'community': 'Communauté',
            'score': 'Points',
            'totalPoints': 'Points d\'Expérience Totaux (XP)',
            'currentLevel': 'Niveau Actuel',
            'completedModules': 'Unités Terminées',
            'earnedCerts': 'Certificats Obtenus',
            'levelUp': 'Félicitations! Vous avez atteint le niveau',
            'level1': '01 - Débutant',
            'level2': '02 - Stagiaire',
            'nextLevelXP': 'XP Requis',
            'pathPetroleum': 'Filière Géologie Pétrolière Avancée',
            'pathMining': 'Filière Mines et Ressources Minérales',
            'quizTitle': 'Quiz Fondamentaux de Géologie Pétrolière',
            'quizQuestion1': 'Quelles sont les principales roches mères du pétrole ?',
            'quizOption1_1': 'Roches ignées',
            'quizOption1_2': 'Roches sédimentaires riches en matière organique',
            'quizOption1_3': 'Roches métamorphiques',
            'quizOption1_4': 'Tous les types de roches',
            'submitAnswer': 'Soumettre et Vérifier la Réponse',
            'correctAnswer': 'Réponse Correcte! (+{points} XP)',
            'wrongAnswer': 'Mauvaise Réponse. La bonne réponse est surlignée en vert.',
            'selectAnswer': 'Veuillez choisir une réponse avant de soumettre',
            'geobotTitle': '🤖 GeoBot: Votre Assistant Intelligent',
            'askGeobot': 'Demandez à GeoBot toute info sur le site...',
            'send': 'Envoyer',
            'geobotWelcome': 'Bienvenue! Je suis GeoBot, votre assistant intelligent. Vous pouvez me poser des questions sur n\'importe quelle partie de cette plateforme.',
            'geobotResponsePrefix': 'Bonjour! D\'après votre question, voici quelques informations concernant "{query}": '
        }
    };
    
    let currentLang = 'ar';

    function setLanguage(lang) {
        currentLang = lang;
        const dict = translations[lang];
        document.body.dir = (lang === 'ar' ? 'rtl' : 'ltr');

        // 1. تحديث النصوص (باستخدام سمة data-key)
        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.getAttribute('data-key');
            if (dict[key]) {
                if (el.tagName === 'TITLE') {
                    document.title = dict[key];
                } else if (el.tagName === 'INPUT' && el.placeholder) {
                    el.placeholder = dict[key];
                } else {
                    el.textContent = dict[key];
                }
            }
        });
        
        // 2. تحديث أزرار اللغة
        document.querySelectorAll('.language-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.getAttribute('data-lang') === lang) {
                btn.classList.add('active');
            }
        });
        
        // 3. تحديث أزرار القائمة
        document.getElementById('startJourneyBtn').textContent = dict['startJourney'];
        document.getElementById('explorePathsBtn').textContent = dict['explorePaths'];
        document.getElementById('openQaModalBtn').textContent = dict['qaCenter'];
        
        // 4. تحديث الأكورديون والعناصر الديناميكية (يتم تحديثها يدويًا أو عند إعادة بناء المكون)
        document.getElementById('pathPetroleumTitle').textContent = dict['pathPetroleum'];
        document.getElementById('quizTitle1').textContent = dict['quizTitle'];
    }

    // ================================= نظام النقاط والمستويات =================================
    const STORAGE_KEY = 'geoready_progress_pro_v3';
    
    // تعريف مستويات XP المطلوبة
    const LEVEL_REQUIREMENTS = {
        1: 50,  // للانتقال من 01 إلى 02
        2: 150, // للانتقال من 02 إلى 03
        3: 300, 
        4: 500
    };

    let appState = {
      score: 0, 
      level: 1, // 👈 يبدأ من المستوى الأول (المبتدئ)
      completedActivities: [],
      history: [],
      historyIndex: -1
    };
    
    function calculateLevel(score) {
        let level = 1;
        for (const [lvl, req] of Object.entries(LEVEL_REQUIREMENTS)) {
            if (score >= req) {
                level = parseInt(lvl) + 1;
            } else {
                break;
            }
        }
        return level;
    }

    function loadProgress() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
                appState = { ...appState, ...JSON.parse(raw) };
            }
            // إعادة حساب المستوى في حال كان هناك خلل في التخزين
            appState.level = calculateLevel(appState.score); 
            
        } catch (e) {
            console.error('Error loading progress:', e);
        }
        updateAllUI();
    }

    function saveProgress() {
        try {
            appState.lastSaved = new Date().toISOString();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
        } catch (e) {
            console.error('Error saving progress:', e);
        }
    }

    function addPoints(points, source, details = {}) {
        saveToHistory(); // حفظ الحالة قبل التغيير
        
        const oldLevel = appState.level;
        appState.score += points;
        
        const newLevel = calculateLevel(appState.score);
        
        appState.completedActivities.push({
            source,
            points,
            date: new Date().toISOString(),
            ...details
        });
        
        if (newLevel > oldLevel) {
            appState.level = newLevel;
            showLevelUpPopup(newLevel); // 👈 إظهار رسالة الترقية
        }
        
        saveProgress();
        updateAllUI();
        showAchievement(translations[currentLang]['correctAnswer'].replace('{points}', points));
    }
    
    function updateAllUI() {
        updateScoreBadge();
        updateDashboardStats();
        updateUndoRedoButtons();
    }

    function updateScoreBadge() {
        document.getElementById('scoreValue').textContent = appState.score.toLocaleString();
        document.getElementById('totalPoints').textContent = appState.score.toLocaleString();
    }

    function updateDashboardStats() {
        const nextLevelReq = LEVEL_REQUIREMENTS[appState.level] || Infinity;
        const xpToNextLevel = nextLevelReq - appState.score;
        const xpInCurrentLevel = appState.score - (LEVEL_REQUIREMENTS[appState.level - 1] || 0);
        const levelSpan = nextLevelReq - (LEVEL_REQUIREMENTS[appState.level - 1] || 0);
        
        let percentage = (xpInCurrentLevel / levelSpan) * 100;
        if (appState.level >= Object.keys(LEVEL_REQUIREMENTS).length + 1) {
            percentage = 100; // حالة الحد الأقصى
        }
        
        document.getElementById('currentLevel').textContent = '0' + appState.level;
        
        const levelTextKey = appState.level === 1 ? 'level1' : appState.level === 2 ? 'level2' : 'level' + appState.level;
        document.getElementById('levelCurrentText').textContent = translations[currentLang][levelTextKey] || `المستوى ${appState.level}`;

        const progressFill = document.querySelector('.progress-fill');
        if (progressFill) progressFill.style.width = `${percentage}%`;
        
        document.getElementById('progressText').textContent = 
            `${Math.round(percentage)}% إلى المستوى التالي (${appState.score} / ${nextLevelReq} XP)`;
    }
    
    function showLevelUpPopup(level) {
        const popup = document.getElementById('levelUpPopup');
        document.getElementById('levelUpText').textContent = `${translations[currentLang]['levelUp']} ${level}!`;
        popup.classList.add('show');
        
        setTimeout(() => {
            popup.classList.remove('show');
        }, 5000);
    }

    // ================================= نظام التراجع والإعادة =================================
    function saveToHistory() {
        // (نفس الوظيفة السابقة)
    }

    function restoreState(index) {
        // (نفس الوظيفة السابقة)
    }

    function undo() {
        // (نفس الوظيفة السابقة)
    }

    function redo() {
        // (نفس الوظيفة السابقة)
    }

    function updateUndoRedoButtons() {
        // (نفس الوظيفة السابقة)
    }
    
    // ================================= نظام الاختبارات المصحح =================================
    function initTests() {
        document.querySelectorAll('.test-option').forEach(option => {
            option.addEventListener('click', function() {
                const testContainer = this.closest('.test-container');
                const options = testContainer.querySelectorAll('.test-option');
                
                // منع تغيير الخيار بعد الإرسال
                if (testContainer.querySelector('.submit-test').disabled) return;
                
                options.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        document.querySelectorAll('.submit-test').forEach(btn => {
            btn.addEventListener('click', function() {
                const testId = this.getAttribute('data-test');
                const testContainer = this.closest('.test-container');
                const selectedOption = testContainer.querySelector('.test-option.selected');
                
                if (!selectedOption) {
                    alert(translations[currentLang]['selectAnswer']);
                    return;
                }
                
                const points = parseInt(this.getAttribute('data-points') || 50);
                const isCorrect = selectedOption.getAttribute('data-correct') === 'true';

                // تعطيل الأزرار لمنع الإرسال المتعدد
                this.disabled = true;
                
                // عرض النتيجة الفورية
                testContainer.querySelectorAll('.test-option').forEach(opt => {
                    opt.style.pointerEvents = 'none'; // تعطيل الخيارات
                    const isOptionCorrect = opt.getAttribute('data-correct') === 'true';
                    
                    if (isOptionCorrect) {
                        opt.classList.add('correct'); // تلوين الإجابة الصحيحة بالأخضر
                        opt.innerHTML += `<span class="feedback-icon"><i class="fas fa-check-circle"></i></span>`;
                    }
                    
                    if (opt === selectedOption && !isCorrect) {
                        opt.classList.add('wrong'); // تلوين الإجابة الخاطئة بالأحمر
                        opt.innerHTML += `<span class="feedback-icon"><i class="fas fa-times-circle"></i></span>`;
                    }
                });
                
                // احتساب النقاط عند الإجابة الصحيحة فقط
                if (isCorrect) {
                    addPoints(points, `test_${testId}`, { testId, correct: true });
                } else {
                    showAchievement(translations[currentLang]['wrongAnswer']);
                }
            });
        });
    }

    // ================================= نظام الأكورديون (الخانة > تفاصيل أخرى) =================================
    function initAccordions() {
      document.querySelectorAll('.accordion-header').forEach(header => {
        header.addEventListener('click', function() {
          const accordion = this.parentElement;
          const isActive = accordion.classList.contains('active');
          
          document.querySelectorAll('.accordion').forEach(acc => {
            if (acc !== accordion) {
              acc.classList.remove('active');
            }
          });
          
          // تفعيل أو إلغاء تفعيل الأكورديون (الخانة > تفاصيل)
          accordion.classList.toggle('active', !isActive); 
          
          if (!isActive) {
              addPoints(5, 'accordion_view', { id: accordion.id }); // مكافأة لفتح تفاصيل جديدة
          }
        });
      });
    }

    // ================================= نظام البوت الذكي (GeoBot) =================================
    
    // قاعدة بيانات GeoBot البسيطة
    const GEOSITE_DATA = {
        'جيولوجيا البترول': 'مسار جيولوجيا البترول المتقدم يركز على تحليل المكامن والبيانات السيزمية وتقييم الحقول. يوفر 3500 XP عند الانتهاء.',
        'الواقع الافتراضي': 'تجارب الواقع الافتراضي تتيح لك استكشاف المواقع الجيولوجية الصعبة والنائية بتقنية 360 درجة، مما يكسبك 15 XP عند البدء.',
        'نقاط الخبرة': 'نقاط الخبرة (XP) هي نظام التلعيب الخاص بنا، تساعدك على تتبع تقدمك والانتقال من مستوى لآخر. المستوى التالي يتطلب 50 XP.',
        'مسار التعدين': 'مسار التعدين يغطي استكشاف الخامات، تقدير الموارد، وتصميم المناجم. وهو مسار شامل يركز على الجيوفيزياء والتنقيب الجيولوجي.',
        'شهادات': 'نقدم شهادات معتمدة مثل شهادة خبير جيولوجيا البترول وشهادة مختص تقدير الموارد، والتي تمنح 1000 XP و 800 XP على التوالي.'
    };

    function geoBotResponse(query) {
        query = query.toLowerCase().trim();
        
        if (query.length < 3) {
            return "الرجاء إدخال سؤال أكثر تحديداً.";
        }
        
        let bestMatch = null;
        for (const keyword in GEOSITE_DATA) {
            if (query.includes(keyword.toLowerCase())) {
                bestMatch = keyword;
                break;
            }
        }
        
        if (bestMatch) {
            return GEOSITE_DATA[bestMatch];
        } else {
            return "آسف، لا أملك معلومات محددة حول هذا الموضوع. يرجى محاولة البحث بكلمات مفتاحية أخرى (مثل: جيولوجيا البترول، الواقع الافتراضي، شهادات).";
        }
    }

    function addChatMessage(sender, message) {
        const chatBox = document.getElementById('chatBox');
        const messageElement = document.createElement('div');
        messageElement.className = `chat-message ${sender === 'user' ? 'chat-user' : 'chat-bot'}`;
        messageElement.innerHTML = `<div class="message-bubble">${message}</div>`;
        chatBox.appendChild(messageElement);
        
        // التمرير لأسفل تلقائياً
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    document.getElementById('sendGeobotMsg').addEventListener('click', function() {
        const input = document.getElementById('geobotInput');
        const query = input.value.trim();
        
        if (query) {
            addChatMessage('user', query);
            input.value = '';
            
            // إضافة نقاط على سؤال البوت (لزيادة التفاعل)
            addPoints(2, 'geobot_query'); 
            
            // محاكاة تأخير البوت
            setTimeout(() => {
                const response = geoBotResponse(query);
                addChatMessage('bot', translations[currentLang]['geobotResponsePrefix'].replace('{query}', query) + response);
            }, 1000);
        }
    });
    
    // تهيئة نافذة البوت
    document.getElementById('openQaModalBtn').addEventListener('click', function() {
      document.getElementById('qaModal').classList.add('active');
      const chatBox = document.getElementById('chatBox');
      chatBox.innerHTML = ''; // تنظيف الشات
      addChatMessage('bot', translations[currentLang]['geobotWelcome']);
    });

    document.getElementById('closeQaModal').addEventListener('click', function() {
      document.getElementById('qaModal').classList.remove('active');
    });

    // ================================= التهيئة عند التحميل =================================
    document.addEventListener('DOMContentLoaded', function() {
      loadProgress(); // تحميل التقدم أولاً

      // تفعيل تغيير اللغة
      document.querySelectorAll('.language-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const lang = this.getAttribute('data-lang');
          setLanguage(lang);
          // بعد تغيير اللغة يجب إعادة تحديث بعض المكونات الديناميكية
          updateDashboardStats();
        });
      });
      
      setLanguage('ar'); // البدء باللغة العربية

      initAccordions();
      initTests();
      
      // ربط أزرار الإجراءات بنظام النقاط
      document.querySelectorAll('.start-tool, .start-activity, .start-certificate, .btn-primary').forEach(btn => {
        if (!btn.classList.contains('submit-test') && !btn.id.includes('Btn')) {
            btn.addEventListener('click', function() {
                const points = parseInt(this.getAttribute('data-points') || 5);
                const activityType = this.getAttribute('data-tool') || this.getAttribute('data-cert') || 'general_click';
                addPoints(points, activityType, { text: this.textContent.trim() });
            });
        }
      });
      
      // تفعيل حركة التنقل
      window.addEventListener('scroll', function() {
        const navbar = document.getElementById('navbar');
        if (window.scrollY > 100) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }
      });
      
      // تفعيل التبويبات (نفس الكود السابق)
      document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', function() {
              const tabId = this.getAttribute('data-tab');
              document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
              this.classList.add('active');
              document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
              document.getElementById(tabId).classList.add('active');
          });
      });
      
      // حفظ الحالة الأولية في التاريخ
      saveToHistory();
      updateUndoRedoButtons();
    });
  </script>
</head>
<body dir="rtl">

  <div class="score-badge">
    <i class="fas fa-star"></i>
    <span data-key="score">نقاط</span>: <span class="score-value" id="scoreValue">0</span>
  </div>

  <div class="language-switcher">
    <button class="language-btn" data-lang="ar">العربية</button>
    <button class="language-btn" data-lang="en">English</button>
    <button class="language-btn" data-lang="fr">Français</button>
  </div>

  <div class="undo-redo-container">
    <button class="undo-btn" id="undoBtn" title="تراجع"><i class="fas fa-undo"></i></button>
    <button class="redo-btn" id="redoBtn" title="إعادة"><i class="fas fa-redo"></i></button>
  </div>

  <header>
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title" data-key="heroTitle">🌍 GeoReady Pro</h1>
        <p class="hero-subtitle" data-key="heroSubtitle">منصة التدريب الجيولوجي المتكاملة | من الجامعة إلى سوق العمل</p>
        <div class="hero-cta">
          <button id="startJourneyBtn" class="btn btn-primary" data-points="10"><i class="fas fa-rocket"></i> ابدأ رحلتك المهنية</button>
          <button id="explorePathsBtn" class="btn btn-outline" data-points="5"><i class="fas fa-compass"></i> استكشف المسارات</button>
          <button id="openQaModalBtn" class="btn btn-outline" data-points="5"><i class="fas fa-question-circle"></i> مركز الأسئلة (GeoBot)</button>
        </div>
      </div>
    </div>
  </header>

  <nav class="navbar" id="navbar">
    <div class="container">
      <div class="nav-content">
        <div class="logo">GeoReady Pro</div>
        <ul class="nav-links">
          <li><a href="#dashboard" class="active"><i class="fas fa-tachometer-alt"></i> <span data-key="dashboard">لوحة القيادة</span></a></li>
          <li><a href="#learning-paths"><i class="fas fa-graduation-cap"></i> <span data-key="learningPaths">مسارات التعلم</span></a></li>
          <li><a href="#interactive-tools"><i class="fas fa-tools"></i> <span data-key="interactiveTools">الأدوات التفاعلية</span></a></li>
          <li><a href="#certificates"><i class="fas fa-certificate"></i> <span data-key="certificates">الشهادات</span></a></li>
          <li><a href="#community"><i class="fas fa-users"></i> <span data-key="community">المجتمع</span></a></li>
        </ul>
      </div>
    </div>
  </nav>
  
  <hr>

  <section id="dashboard" class="dashboard-section">
    <div class="container">
      <h2 class="section-title animate-on-scroll" data-key="dashboard">📊 لوحة القيادة الشخصية</h2>
      
      <div class="dashboard-grid animate-on-scroll">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-trophy"></i></div>
          <div class="stat-number" id="totalPoints">0</div>
          <div class="stat-label" data-key="totalPoints">نقاط الخبرة الكلية (XP)</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-star"></i></div>
          <div class="stat-number" id="currentLevel">01</div>
          <div class="stat-label" data-key="currentLevel">المستوى الحالي</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
          <div class="stat-number" id="completedModules">0</div>
          <div class="stat-label" data-key="completedModules">وحدة مكتملة</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-certificate"></i></div>
          <div class="stat-number" id="earnedCerts">0</div>
          <div class="stat-label" data-key="earnedCerts">شهادة محققة</div>
        </div>
      </div>

      <div class="progress-section animate-on-scroll">
        <h3>🎯 رحلتك نحو الاحتراف</h3>
        <div class="level-display">
          <div class="level-badge">
            <h4>المستوى الحالي</h4>
            <div style="font-size: 2rem; font-weight: 900;" id="levelCurrentText">01 - مبتدئ</div>
          </div>
          <div class="level-badge">
            <h4>التقدم المطلوب</h4>
            <div style="font-size: 1.5rem;" data-key="nextLevelXP">50 XP</div>
          </div>
        </div>
        
        <div class="progress-bar-container">
          <div class="progress-bar">
            <div class="progress-fill" style="width: 0%"></div>
          </div>
          <p id="progressText">0% إلى المستوى التالي (0 / 50 XP)</p>
        </div>
      </div>
    </div>
  </section>
  
  <hr>

  <section class="interactive-section">
    <div class="container">
      <h2 class="section-title animate-on-scroll">🚀 أحدث طرق العرض والتدريب</h2>
      <p class="section-subtitle animate-on-scroll" style="color: rgba(255,255,255,0.8);">استمتع بتجربة تعلم تفاعلية باستخدام أحدث التقنيات والمنهجيات</p>
      
      <div class="tab-container animate-on-scroll">
        <div class="tab-header">
          <button class="tab-btn active" data-tab="virtual-reality">الواقع الافتراضي</button>
          <button class="tab-btn" data-tab="simulations">المحاكاة التفاعلية</button>
          <button class="tab-btn" data-tab="gamification">التلعيب</button>
        </div>
        <div class="tab-content">
          <div class="tab-pane active" id="virtual-reality">
            <p style="color: #ccc;">استكشف المواقع الجيولوجية المعقدة من خلال تجارب الواقع الافتراضي المذهلة. تسلق الجبال، استكشف المناجم، واغوص في أعماق الأرض دون مغادرة منزلك.</p>
            <div class="feature-grid">
              <div class="modern-card">
                <div class="feature-icon"><i class="fas fa-vr-cardboard"></i></div>
                <h4 class="feature-title">رحلات ميدانية افتراضية</h4>
                <p class="feature-description" style="color: #ccc;">زيارة مواقع جيولوجية حقيقية حول العالم بتقنية 360 درجة.</p>
                <button class="btn btn-success start-tool" data-tool="vr-trip" data-points="15">ابدأ جولة VR (+15 XP)</button>
              </div>
            </div>
          </div>
          </div>
      </div>
    </div>
  </section>

  <hr>

  <section id="learning-paths" class="learning-paths">
    <div class="container">
      <h2 class="section-title animate-on-scroll" data-key="learningPaths">🎓 مسارات التعلم التخصصية</h2>
      
      <div class="accordion-container">
        <div class="accordion" id="accordion-1">
          <div class="accordion-header"> <h3 id="pathPetroleumTitle" data-key="pathPetroleum">مسار جيولوجيا البترول المتقدم</h3>
            <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
          </div>
          <div class="accordion-content"> <div class="test-container" id="test-1">
              <h3 id="quizTitle1" class="test-title">اختبار أساسيات جيولوجيا البترول</h3>
              <p class="test-question" data-key="quizQuestion1">ما هي الصخور المصدر الرئيسية للنفط؟</p>
              
              <ul class="test-options">
                <li class="test-option" data-correct="false" data-key="quizOption1_1">الصخور النارية</li>
                <li class="test-option" data-correct="true" data-key="quizOption1_2">الصخور الرسوبية الغنية بالمواد العضوية</li>
                <li class="test-option" data-correct="false" data-key="quizOption1_3">الصخور المتحولة</li>
                <li class="test-option" data-correct="false" data-key="quizOption1_4">جميع أنواع الصخور</li>
              </ul>
              <button class="btn btn-primary submit-test" data-test="test-1" data-points="50" data-key="submitAnswer">إرسال الإجابة والتحقق</button>
            </div>
          </div>
        </div>

        <div class="accordion" id="accordion-2">
          <div class="accordion-header"> <h3 data-key="pathMining">مسار التعدين والموارد المعدنية</h3>
            <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
          </div>
          <div class="accordion-content"> <button class="btn btn-primary start-tool" data-tool="start-mining" data-points="15">بدء هذا المسار (+15 XP)</button>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <hr>

  <section id="interactive-tools" class="interactive-tools">
    <div class="container">
      <h2 class="section-title animate-on-scroll" data-key="interactiveTools">🛠️ الأدوات التفاعلية والمحاكيات</h2>
      
      <div class="tools-grid">
        <div class="tool-card animate-on-scroll">
          <div class="tool-icon"><i class="fas fa-cube"></i></div>
          <h3 class="tool-title">محاكي النمذجة ثلاثية الأبعاد</h3>
          <button class="btn btn-primary start-tool" data-tool="3d-modeler" data-points="10">تجربة الأداة (+10 XP)</button>
        </div>

        <div class="tool-card animate-on-scroll">
          <div class="tool-icon"><i class="fas fa-chart-area"></i></div>
          <h3 class="tool-title">محلل البيانات السيزمية</h3>
          <button class="btn btn-primary start-tool" data-tool="seismic-analyzer" data-points="25">تجربة الأداة (+25 XP)</button>
        </div>
      </div>
    </div>
  </section>

  <hr>
  
  <section id="certificates" class="certificates-section">
    <div class="container">
      <h2 class="section-title animate-on-scroll" data-key="certificates">🏆 نظام الشهادات المهنية</h2>
      
      <div class="cert-grid">
        <div class="cert-card animate-on-scroll">
          <div class="cert-icon"><i class="fas fa-medal"></i></div>
          <h3 class="cert-title">شهادة خبير جيولوجيا البترول</h3>
          <button class="btn btn-primary start-certificate" data-cert="cert-petroleum" data-points="1000">التقدم للشهادة (+1000 XP)</button>
        </div>
      </div>
    </div>
  </section>

  <hr>

  <section id="community" class="community-section">
    <div class="container">
      <h2 class="section-title animate-on-scroll" data-key="community">👥 المجتمع المهني والدعم</h2>
      
      <div class="community-grid">
        <div class="community-card animate-on-scroll">
          <div style="font-size: 3rem; margin-bottom: 25px; color: var(--primary-blue);">
            <i class="fas fa-comments"></i>
          </div>
          <h3 style="font-size: 1.5rem;">منتديات النقاش</h3>
          <button class="btn btn-primary start-activity" data-activity="forums" data-points="5">انضم للمنتديات (+5 XP)</button>
        </div>
      </div>
    </div>
  </section>

  <footer>
    </footer>

  <div class="qa-modal" id="qaModal">
    <div class="qa-container">
      <div class="qa-header">
        <h2 data-key="geobotTitle">🤖 GeoBot: مساعدك الذكي</h2>
        <button class="close-btn" id="closeQaModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="qa-body">
        <div class="chat-box" id="chatBox">
          </div>
        <div class="input-group">
          <input type="text" id="geobotInput" data-key="askGeobot" placeholder="اسأل GeoBot أي معلومة في الموقع..." onkeydown="if(event.key === 'Enter') document.getElementById('sendGeobotMsg').click()">
          <button class="btn btn-primary" id="sendGeobotMsg" data-points="2" data-key="send">إرسال</button>
        </div>
      </div>
    </div>
  </div>

  <div class="achievement-popup" id="achievementPopup">
    </div>
  
  <div class="level-up-popup" id="levelUpPopup">
    <i class="fas fa-crown" style="font-size: 3rem; margin-bottom: 20px;"></i>
    <h2 id="levelUpText" style="font-size: 2.5rem; font-weight: 700;">تهانينا! لقد وصلت إلى المستوى 2!</h2>
    <p style="font-size: 1.2rem; margin-top: 15px;">تم فتح محتوى وتحديات جديدة.</p>
  </div>
</body>
</html>
