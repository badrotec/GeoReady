<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GeoReady â€” 10x Edition</title>
<style>
  :root{
    --bg1:#041426; --card:#071726; --muted:#9fb0c8;
    --accent1:#06b6d4; --accent2:#7c3aed; --accent3:#ff8a3d;
    --good:#16a34a; --bad:#ef4444; --glass: rgba(255,255,255,0.03);
    --warn:#facc15;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, "Segoe UI", Arial, sans-serif; background:linear-gradient(180deg,#031022 0%,#071428 70%); color:#eef7ff; position:relative;}
  
  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª: Wrap and Header --- */
  .wrap{max-width:600px;margin:0 auto;padding:12px; position:relative; z-index:10;}
  header{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:12px}
  .brand{display:flex;align-items:center;gap:8px}
  .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:900;color:#fff; font-size:18px; flex-shrink:0;}
  h1{margin:0;font-size:18px; line-height:1.2}
  .subtitle{color:var(--muted);font-size:12px}
  
  .controls{display:flex;gap:6px;align-items:center}
  button.btn{background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;padding:7px 10px;border-radius:6px;color:#fff;cursor:pointer;font-weight:700; font-size:13px; transition: transform 0.15s, box-shadow 0.15s;}
  button.btn:hover{transform:translateY(-1px); box-shadow: 0 4px 10px rgba(0,0,0,0.2);}
  button.btn:active{transform:translateY(0px); opacity:0.9;}
  
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 9px;border-radius:6px;color:var(--muted); font-size:13px; cursor:pointer;}
  button.ghost:hover{background:var(--glass); color:#fff;}
  
  .lang-toggle, .settings-btn {
    background:var(--glass);padding:6px 8px;border-radius:6px;cursor:pointer;color:var(--muted); font-size:13px; line-height: 1;
    display:flex; align-items:center; justify-content:center; width: 34px; height: 34px;
  }
  .lang-toggle { width: auto; padding: 6px 9px; }
  .settings-btn svg { width: 18px; height: 18px; fill: var(--muted); }
  .settings-btn:hover svg { fill: #fff; }

  .container{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:10px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,0.5)}
  
  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Section Cards (with icons) --- */
  .sections{display:grid;grid-template-columns:1fr;gap:10px;margin-bottom:12px}
  .section-card{background:var(--card);padding:12px;border-radius:8px;cursor:pointer;transition:transform .22s,box-shadow .22s;box-shadow:0 4px 12px rgba(2,6,23,0.4); display:flex; align-items:center; gap:12px;}
  .section-card:hover{transform:none;box-shadow:0 6px 16px rgba(2,6,23,0.5)}
  .section-icon{font-size:24px; opacity:0.6;}
  .section-title{font-weight:800;font-size:15px}
  .section-desc{color:var(--muted);font-size:12px;margin-top:4px}
  
  /* --- Quiz Area & Question Card --- */
  .quiz-area{margin-top:8px;min-height:300px;position:relative;overflow:hidden}
  .question-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);transition:transform .35s,opacity .35s; position:relative;}
  .fade-in{animation:fadeIn .28s ease}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  
  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Question Meta (Added Streak) --- */
  .question-meta{display:flex;flex-direction:column-reverse;justify-content:space-between;align-items:center;margin-bottom:10px;gap:8px} 
  .qnum{font-weight:800;color:var(--accent3);padding:4px 8px;border-radius:6px;background:var(--glass); font-size:14px}
  .timer{font-weight:900;padding:4px 8px;border-radius:6px;background:var(--glass); min-width:60px; text-align:center; transition: color 0.3s, background 0.3s;}
  .timer.timer-warn { background: rgba(239, 68, 68, 0.2); color: var(--bad); animation: pulseWarn 1s infinite; }
  @keyframes pulseWarn { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

  .question-meta > div:last-child {display:flex;gap:12px;align-items:center; width:100%; justify-content:space-between;}
  
  .scorebox{min-width:120px;text-align:center; padding: 4px 0;}
  .score-value{font-size:18px;font-weight:900;color:var(--accent1)}
  .level-badge{display:inline-block;padding:4px 8px;border-radius:999px;background:var(--glass);margin-top:4px;color:var(--muted); font-size:11px}
  
  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Streak Counter --- */
  .streak-counter {
    font-size: 16px; font-weight: 800; color: var(--warn);
    opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: scale(0.8);
  }
  .streak-counter.visible { opacity: 1; transform: scale(1); }

  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Image Question --- */
  .q-image-container {
    margin: 6px 0 10px;
    text-align: center;
    max-height: 180px;
    overflow: hidden;
    border-radius: 6px;
  }
  .q-image-container img {
    width: 100%; height: auto; max-height: 180px;
    object-fit: cover; border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);
  }

  .question-text{font-size:15px;margin:6px 0 10px}
  .answers{display:flex;flex-direction:column;gap:8px}
  .answer{background:var(--glass);padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;transition:transform .12s,background .12s, border-color 0.12s;display:flex;align-items:center;gap:8px; font-size:14px}
  .answer:not(.correct):not(.wrong):hover{transform:translateY(-2px); background:rgba(255,255,255,0.06);}
  .answer .opt-label{min-width:26px;text-align:center;font-weight:800; font-size:14px}
  
  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Answer visual feedback --- */
  .answer.correct { background: rgba(22, 163, 74, 0.2); border-color: var(--good); }
  .answer.wrong { background: rgba(239, 68, 68, 0.2); border-color: var(--bad); }
  .answer.pulse { animation: pulseGreen 0.4s; }
  .answer.shake { animation: shakeRed 0.4s; }
  @keyframes pulseGreen { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
  @keyframes shakeRed { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }


  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Floating Score Popup --- */
  .score-popup-area {
    position: absolute;
    top: 50px; right: 20px;
    z-index: 100;
    pointer-events: none;
  }
  .score-popup {
    font-size: 18px; font-weight: 900;
    padding: 4px 8px; border-radius: 6px;
    position: absolute;
    animation: floatUpFade 1.2s ease-out;
  }
  .score-popup.good { color: var(--good); }
  .score-popup.bad { color: var(--bad); }
  @keyframes floatUpFade {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-30px); }
  }

  .progress-wrap{display:flex;align-items:center;gap:6px;margin-top:10px}
  .progress-bar{flex:1;height:8px;background:rgba(255,255,255,0.03);border-radius:8px;overflow:hidden}
  .progress-bar > div{height:100%;background:linear-gradient(90deg,var(--accent1),var(--accent2));width:0%; transition: width 0.3s;}
  .small-muted{color:var(--muted);font-size:11px}
  
  .controls-bottom{display:flex;gap:6px;align-items:center;margin-top:10px; flex-wrap:wrap; justify-content:space-between}
  .controls-bottom .ghost { flex-grow:1; }
  .controls-bottom #timeTip { order:3; flex-basis:100%; text-align:center; margin-top:6px; }

  /* --- Modals (Result, Leaderboard, Settings, Resume) --- */
  .modal-panel{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:10px;background:linear-gradient(180deg, rgba(2,6,23,0.7), rgba(2,6,23,0.9));backdrop-filter:blur(3px); z-index:1000;}
  .modal-card{background:linear-gradient(180deg,#071226,#08162a);padding:18px;border-radius:10px;width:95%;max-width:400px;border:1px solid rgba(255,255,255,0.04);text-align:center; animation: fadeIn 0.2s;}
  
  /* --- Result Modal --- */
  .bigscore{font-size:36px;font-weight:900;color:var(--accent2);margin:6px 0}
  .res-details{color:var(--muted);margin-top:6px; font-size:13px; text-align:right; direction:rtl;}
  [dir="ltr"] .res-details { text-align: left; }
  .res-actions{display:flex;gap:6px;justify-content:center;margin-top:12px; flex-wrap: wrap;}
  
  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Leaderboard Modal --- */
  .leaderboard-list {
    max-height: 300px; overflow-y: auto;
    text-align: right; direction:rtl;
    margin-top: 10px; border-top: 1px solid var(--glass);
    padding-top: 10px;
  }
  [dir="ltr"] .leaderboard-list { text-align: left; }
  .leaderboard-item {
    padding: 8px 6px; border-bottom: 1px solid var(--glass);
    display: flex; justify-content: space-between; align-items: center;
    font-size: 13px;
  }
  .leaderboard-item:last-child { border-bottom: none; }
  .leaderboard-item .score { font-weight: 800; color: var(--accent1); flex-shrink: 0; }
  .leaderboard-item .details { display:flex; flex-direction:column; align-items: flex-end; }
  [dir="ltr"] .leaderboard-item .details { align-items: flex-start; }
  .leaderboard-item .title { font-weight: 700; }
  .leaderboard-item .date { font-size: 11px; color: var(--muted); }

  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Review Modal --- */
  .review-list { max-height: 300px; overflow-y: auto; text-align: right; direction:rtl; margin: 10px 0; }
  [dir="ltr"] .review-list { text-align: left; }
  .review-item { padding: 8px; border-bottom: 1px solid var(--glass); }
  .review-item .q-text { font-weight: 700; font-size: 14px; margin-bottom: 4px; }
  .review-item .r-ans { color: var(--bad); font-size: 13px; }
  .review-item .c-ans { color: var(--good); font-size: 13px; }

  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Settings Modal --- */
  .settings-group { text-align: right; direction: rtl; margin-bottom: 15px; }
  [dir="ltr"] .settings-group { text-align: left; }
  .settings-group label { display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 14px; }
  /* Basic toggle switch */
  .toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; }
  .toggle-switch input { opacity: 0; width: 0; height: 0; }
  .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--glass); transition: .3s; border-radius: 34px; }
  .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
  input:checked + .slider { background-color: var(--accent1); }
  input:checked + .slider:before { transform: translateX(20px); }

  /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Resume Prompt --- */
  .resume-prompt {
    position: fixed; top: 12px; left: 50%; transform: translateX(-50%);
    background: linear-gradient(135deg, var(--accent3), var(--accent2));
    padding: 12px 16px;
    border-radius: 8px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    z-index: 1001;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: fadeIn 0.3s;
  }
  .resume-prompt .msg { font-size: 14px; font-weight: 700; color: #fff; }
  .resume-prompt .btn { padding: 5px 8px; font-size: 13px; }
  .resume-prompt .ghost { border-color: rgba(255,255,255,0.3); color: #fff; }

  footer{font-size:11px; padding-bottom: 20px; text-align:center;color:var(--muted);margin-top:10px}

  /* --- Media Queries for Desktop --- */
  @media(min-width:600px){ 
    .wrap{max-width:900px;margin:18px auto;padding:16px}
    .sections{grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:14px}
    .section-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
    .question-meta{display:flex;flex-direction:row; gap:10px; margin-bottom:12px; }
    .question-meta > div:last-child { width:auto; justify-content:flex-end; }
    .scorebox{min-width:220px; text-align:center; padding: 0;}
    h1{font-size:20px}
    .subtitle{font-size:13px}
    .q-image-container { max-height: 220px; }
    .q-image-container img { max-height: 220px; }
  }
</style>
</head>
<body>
  
  <div class="score-popup-area" id="scorePopupArea"></div>

  <div class="resume-prompt" id="resumePrompt" style="display:none">
    <div class="msg" id="resumeMsg">Ù„Ø¯ÙŠÙƒ Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± Ù…ÙƒØªÙ…Ù„!</div>
    <button class="btn" id="resumeYes">Ø§Ø³ØªØ¦Ù†Ø§Ù</button>
    <button class="ghost" id="resumeNo">Ø¨Ø¯Ø¡ Ø¬Ø¯ÙŠØ¯</button>
  </div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">GQ</div>
        <div>
          <h1>GeoReady â€” 10x</h1>
          <div class="subtitle">ØªØ¯Ø±ÙŠØ¨ Ù…ÙŠØ¯Ø§Ù†ÙŠ ØªÙØ§Ø¹Ù„ÙŠ â€” Ø¹Ø±Ø¨ÙŠ / English</div>
        </div>
      </div>

      <div class="controls">
        <div class="lang-toggle" id="langToggle">Ø§Ù„Ø¹Ø±Ø¨ÙŠ / EN</div>
        <button class="ghost" id="leaderBtn">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        <button class="settings-btn" id="settingsBtn" title="Settings">
          <svg viewBox="0 0 20 20"><path d="M10 3.75c-3.45 0-6.25 2.8-6.25 6.25s2.8 6.25 6.25 6.25 6.25-2.8 6.25-6.25-2.8-6.25-6.25-6.25zM10 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"></path><path d="M10 8.12c-1.04 0-1.88.84-1.88 1.88s.84 1.88 1.88 1.88 1.88-.84 1.88-1.88-.84-1.88-1.88-1.88zM19.4 7.5l-2.28-1.42c-.1-.63-.26-1.24-.48-1.82l.85-2.58-2.12-2.12-2.58.85c-.58-.22-1.19-.38-1.82-.48l-1.42-2.28h-3l-1.42 2.28c-.63.1-1.24.26-1.82.48l-2.58-.85-2.12 2.12.85 2.58c-.22.58-.38 1.19-.48 1.82l-2.28 1.42v3l2.28 1.42c.1.63.26 1.24.48 1.82l-.85 2.58 2.12 2.12 2.58-.85c.58.22 1.19.38 1.82.48l1.42 2.28h3l1.42-2.28c.63-.1 1.24-.26 1.82-.48l2.58.85 2.12-2.12-.85-2.58c.22-.58.38 1.19.48 1.82l2.28-1.42v-3zM17.17 11.16c-.2.12-.38.29-.53.47l-.68 1.25 1.21 1.21.68-1.25c.18-.33.43-.63.73-.87l1.12-1.12v-1.12l-1.12-1.12c-.3-.24-.57-.5-.87-.73l-1.25-.68-1.21 1.21 1.25.68c.18.1.35.21.47.35l.08.08c-.01 0-.01 0 0 0zM4.6 11.72c.18.33.43.63.73.87l1.12 1.12v1.12l-1.12 1.12c-.3.24-.57.5-.87.73l-1.25.68-1.21-1.21 1.25-.68c.18-.1.35-.21.47-.35s.23-.3.35-.47l.68-1.25-1.21-1.21-.68 1.25c-.18.33-.43.63-.73.87l-1.12 1.12v-1.12l1.12-1.12c.3-.24.57-.5.87-.73l1.25-.68 1.21 1.21-1.25.68c-.18.1-.35.21-.47.35zM11.16 2.83c.12.2.29.38.47.53l1.25.68 1.21-1.21-1.25-.68c-.33-.18-.63-.43-.87-.73l-1.12-1.12h-1.12l-1.12 1.12c-.24.3-.5.57-.73.87l-.68 1.25 1.21 1.21.68-1.25c.1-.18.21-.35.35-.47z"></path></svg>
        </button>
      </div>
    </header>

    <main class="container">
      <section>
        <div class="sections" id="sectionList"></div>
      </section>

      <section class="quiz-area" id="quizArea" style="display:none">
        <div class="question-card fade-in" id="questionCard">
          <div class="question-meta">
            <div class="qnum" id="qLabel">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 / Q1</div>
            <div>
              <div class="streak-counter" id="streakCounter">ğŸ”¥ 0</div>
              <div class="scorebox">
                <div class="small-muted" id="scoreLabel">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                <div class="score-value" id="scoreVal">0</div>
                <div class="level-badge" id="levelBadge">Ù…Ø¨ØªØ¯Ø¦</div>
              </div>
              <div class="timer" id="timerLabel">00:30</div>
            </div>
          </div>
          
          <div class="q-image-container" id="qImageContainer" style="display:none;">
            <img id="qImage" src="" alt="Question Image" />
          </div>

          <div class="question-text" id="qText">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ â€¦</div>
          <div class="answers" id="answersBox"></div>

          <div class="progress-wrap">
            <div class="small-muted" id="progressLabel">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 30</div>
            <div class="progress-bar"><div id="progInner"></div></div>
            <div style="width:100px;text-align:right">
              <button class="btn" id="skipBtn">ØªØ¬Ø§ÙˆØ²</button>
            </div>
          </div>

          <div class="controls-bottom">
            <button class="ghost" id="backToMenu">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            <div style="flex:1"></div>
            <div class="small-muted" id="timeTip">Ø§Ù„Ù…Ø¯Ø© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„: 30 Ø«Ø§Ù†ÙŠØ©</div>
          </div>
        </div>
      </section>

    </main>

    <footer style="text-align:center;color:var(--muted);margin-top:10px">GeoReady 10x â€” Ù†Ù…ÙˆØ°Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ Ù…Ø·ÙˆØ± â€¢ ÙŠØ­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­</footer>
  </div>

  <div id="resultModal" class="modal-panel" style="display:none">
    <div class="modal-card">
      <h2 id="resTitle">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
      <div class="bigscore" id="resScore">0 Ù†Ù‚Ø·Ø©</div>
      <div class="res-details" id="resDetails"></div>
      <div class="res-actions">
        <button class="ghost" id="reviewBtn">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</button>
        <button class="btn" id="retryBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        <button class="ghost" id="closeResBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div style="margin-top:10px" class="small-muted" id="savedNote"></div>
    </div>
  </div>
  
  <div id="leaderboardModal" class="modal-panel" style="display:none">
    <div class="modal-card">
      <h2 id="leaderTitle">Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
      <div class="leaderboard-list" id="leaderboardList">
        </div>
      <div class="res-actions">
        <button class="ghost" id="closeLeaderBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
  
  <div id="reviewModal" class="modal-panel" style="display:none">
    <div class="modal-card">
      <h2 id="reviewTitle">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</h2>
      <div class="review-list" id="reviewList">
        </div>
      <div class="res-actions">
        <button class="ghost" id="closeReviewBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <div id="settingsModal" class="modal-panel" style="display:none">
    <div class="modal-card">
      <h2 id="settingsTitle">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
      <div class="settings-group">
        <label for="audioToggle">
          <span id="audioToggleLabel">Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</span>
          <div class="toggle-switch">
            <input type="checkbox" id="audioToggle" checked>
            <span class="slider"></span>
          </div>
        </label>
      </div>
      <div class="settings-group">
        <button class="btn" id="clearDataBtn" style="background:var(--bad); width: 100%;">
          Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        </button>
        <div class="small-muted" id="clearDataWarning" style="margin-top:5px;">(Ø§Ù„Ù†ØªØ§Ø¦Ø¬ + Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©)</div>
      </div>
      <div class="res-actions">
        <button class="ghost" id="closeSettingsBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>


<script>
/* GeoReady 10x Edition â€” Full single-file quiz app
   --- 10x Features ---
   - Resume Quiz: Saves state to localStorage, prompts user to continue.
   - Streaks: Bonus points for consecutive correct answers.
   - Image Questions: Added 'image_url' to data structure for visual questions.
   - Modals: Replaced 'alert' leaderboard. Added Settings & Review modals.
   - Visual FX: Timer warning, answer shake/pulse, score popups.
   - Audio Toggle: Setting to mute beeps.
   - Full i18n: All new UI text is translatable.
   - Answer Review: Users can review wrong answers post-quiz.
*/

/* ---------- Language ---------- */
const LANGS = {
  ar: {
    start: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±",
    skip: "ØªØ¬Ø§ÙˆØ²",
    retry: "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©",
    close: "Ø¥ØºÙ„Ø§Ù‚",
    score: "Ø§Ù„Ù†Ù‚Ø§Ø·",
    level: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰",
    questionOf: "Ø§Ù„Ø³Ø¤Ø§Ù„ {i} Ù…Ù† {n}",
    savedNote: "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ.",
    leaderboard: "Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬",
    leaderboardEmpty: "Ù„Ø§ Ù†ØªØ§Ø¦Ø¬ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.",
    streak: "Ø³Ù„Ø³Ù„Ø©",
    resumePrompt: "Ù„Ø¯ÙŠÙƒ Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± Ù…ÙƒØªÙ…Ù„!",
    resume: "Ø§Ø³ØªØ¦Ù†Ø§Ù",
    startNew: "Ø¨Ø¯Ø¡ Ø¬Ø¯ÙŠØ¯",
    review: "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡",
    yourAnswer: "Ø¥Ø¬Ø§Ø¨ØªÙƒ",
    correctAnswer: "Ø§Ù„ØµØ­ÙŠØ­Ø©",
    settings: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
    audioFX: "Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©",
    clearData: "Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©",
    clearDataWarn: "(Ø§Ù„Ù†ØªØ§Ø¦Ø¬ + Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©)",
    clearDataConfirm: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©.",
    finalResult: "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©",
    section: "Ø§Ù„Ù‚Ø³Ù…",
    correct: "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©",
    wrongSkipped: "Ø§Ù„Ø®Ø§Ø·Ø¦Ø©/Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ²Ø©",
    percent: "Ø§Ù„Ù†Ø³Ø¨Ø©",
    points: "Ù†Ù‚Ø·Ø©",
    beginner: "Ù…Ø¨ØªØ¯Ø¦",
    advanced: "Ù…ØªÙ‚Ø¯Ù… ğŸ”°",
    fieldPro: "Ù…ÙŠØ¯Ø§Ù†ÙŠ ğŸª¨",
    expert: "Ø®Ø¨ÙŠØ± ğŸ’"
  },
  en: {
    start: "Start Quiz",
    skip: "Skip",
    retry: "Retry",
    close: "Close",
    score: "Score",
    level: "Level",
    questionOf: "Question {i} of {n}",
    savedNote: "Saved locally in your browser.",
    leaderboard: "Leaderboard",
    leaderboardEmpty: "No saved results yet.",
    streak: "Streak",
    resumePrompt: "You have an unfinished quiz!",
    resume: "Resume",
    startNew: "Start New",
    review: "Review Answers",
    yourAnswer: "Your Answer",
    correctAnswer: "Correct",
    settings: "Settings",
    audioFX: "Audio Effects",
    clearData: "Clear All Saved Data",
    clearDataWarn: "(Scores + Pending Quizzes)",
    clearDataConfirm: "Are you sure? This will delete all scores and pending quizzes.",
    finalResult: "Final Result",
    section: "Section",
    correct: "Correct",
    wrongSkipped: "Wrong/Skipped",
    percent: "Percent",
    points: "points",
    beginner: "Beginner",
    advanced: "Advanced ğŸ”°",
    fieldPro: "Field Pro ğŸª¨",
    expert: "Expert ğŸ’"
  }
};
let lang = localStorage.getItem('geo_lang') || 'ar';
function t(key, vars){ const s = LANGS[lang][key] || key; if(!vars) return s; return s.replace(/{(\w+)}/g,(m,k)=>vars[k]||m); }
function refreshLangUI(){ 
  // Main UI
  document.getElementById('scoreLabel').textContent = t('score'); 
  document.getElementById('skipBtn').textContent = t('skip'); 
  langToggle.textContent = (lang==='ar')? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠ / EN' : 'AR / English';
  document.getElementById('leaderBtn').textContent = t('leaderboard');
  document.getElementById('settingsBtn').title = t('settings');
  document.getElementById('backToMenu').textContent = t('backToMenu') || 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©';
  
  // Result Modal
  document.getElementById('resTitle').textContent = t('finalResult');
  document.getElementById('retryBtn').textContent = t('retry'); 
  document.getElementById('closeResBtn').textContent = t('close');
  document.getElementById('reviewBtn').textContent = t('review');
  
  // Leaderboard Modal
  document.getElementById('leaderTitle').textContent = t('leaderboard');
  document.getElementById('closeLeaderBtn').textContent = t('close');
  
  // Review Modal
  document.getElementById('reviewTitle').textContent = t('review');
  document.getElementById('closeReviewBtn').textContent = t('close');

  // Settings Modal
  document.getElementById('settingsTitle').textContent = t('settings');
  document.getElementById('audioToggleLabel').textContent = t('audioFX');
  document.getElementById('clearDataBtn').textContent = t('clearData');
  document.getElementById('clearDataWarning').textContent = t('clearDataWarn');
  document.getElementById('closeSettingsBtn').textContent = t('close');

  // Resume Prompt
  document.getElementById('resumeMsg').textContent = t('resumePrompt');
  document.getElementById('resumeYes').textContent = t('resume');
  document.getElementById('resumeNo').textContent = t('startNew');
}

/* ---------- Quiz data (4Ã—30) ----------
   --- 10x Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ---
   - Ø¥Ø¶Ø§ÙØ© `icon` Ù„ÙƒÙ„ Ù‚Ø³Ù….
   - Ø¥Ø¶Ø§ÙØ© `image_url` Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ø®Ø§ØµØ© ÙÙŠ petro Ùˆ maps) Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©.
*/
const QUIZZES = {
  hydro: {
    title_ar: "Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ â€” Ø£Ø³Ø§Ø³ÙŠ", title_en: "Hydrogeology â€” Basic", icon: "ğŸ’§",
    items: [
      { q_ar:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© Ø§Ù„Ø­Ø±Ø© ÙˆØ§Ù„Ù…Ø­Ø¨ÙˆØ³Ø©ØŸ", q_en:"Difference between unconfined and confined aquifer?", 
        // --- 10x: Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© ---
        image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Aquifer_types-en.svg/640px-Aquifer_types-en.svg.png",
        choices_ar:["Ø§Ù„Ø­Ø±Ø© Ù„Ù‡Ø§ Ù…Ù†Ø³ÙˆØ¨ Ù…Ø§Ø¡ Ù…ØªØ³Ø§ÙˆÙ Ù…Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠØŒ Ø§Ù„Ù…Ø­Ø¨ÙˆØ³Ø© ØªØ­Øª Ø¶ØºØ· Ø§Ø±ØªÙˆØ§Ø²ÙŠ","Ø§Ù„Ø­Ø±Ø© Ø£Ù‚Ù„ Ù†ÙØ§Ø°ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø­Ø¨ÙˆØ³Ø©","Ø§Ù„Ù…Ø­Ø¨ÙˆØ³Ø© ÙÙˆÙ‚ Ø§Ù„Ø³Ø·Ø­ ÙÙ‚Ø·","Ø§Ù„Ø­Ø±Ø© Ù…ÙƒÙ‘ÙˆÙ†Ø© Ù…Ù† Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ù†Ø§Ø±ÙŠØ© ÙÙ‚Ø·"], choices_en:["Unconfined has water table; confined under artesian pressure","Unconfined less permeable than confined","Confined exists only at surface","Unconfined made of igneous rocks only"], answerIndex:0 },
      { q_ar:"Ù…Ø§ Ù†ÙˆØ¹ Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„ØªÙŠ ØªØ´ÙƒÙ„ Ø£ÙØ¶Ù„ Ø®Ø²Ø§Ù†Ø§Øª Ù…Ø§Ø¦ÙŠØ©ØŸ", q_en:"Which rock types make the best aquifers?", choices_ar:["Ø§Ù„Ø±Ù…Ù„ ÙˆØ§Ù„Ø­ØµÙ‰ ÙˆØ§Ù„Ø­Ø¬Ø± Ø§Ù„Ø¬ÙŠØ±ÙŠ Ø§Ù„Ù…ØªØ´Ù‚Ù‚","Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ø·ÙŠÙ†ÙŠØ© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©","Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ø¨Ù„ÙˆØ±ÙŠØ© ØºÙŠØ± Ø§Ù„Ù…Ø´Ù‚Ù‚Ø©","Ø§Ù„Ø´ÙØ¹ÙØ¨ Ø§Ù„Ø¨Ø±ÙƒØ§Ù†ÙŠØ©"], choices_en:["Sands, gravels and fractured limestones","Compact clays","Unfractured crystalline rocks","Volcanic reefs"], answerIndex:0 },
      { q_ar:"Ù…Ø§ Ø§Ù„Ù…Ù‚ØµÙˆØ¯ Ø¨Ø§Ù„Ù€ AquicludeØŸ", q_en:"What is an aquiclude?", choices_ar:["Ø·Ø¨Ù‚Ø© ØªÙ…Ù†Ø¹ Ù…Ø±ÙˆØ± Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¹Ù…Ù„ÙŠÙ‹Ø§ (Ø·ÙŠÙ†ÙŠØ© Ø¹Ø§Ø¯Ø©)","Ø®Ø²Ø§Ù† Ù…Ø§Ø¦ÙŠ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ù†ÙØ§Ø°ÙŠØ©","Ù…Ø¬Ø±Ù‰ Ù†Ù‡Ø±ÙŠ Ø³Ø·Ø­ÙŠ","ÙˆØ­Ø¯Ø© ØµØ®Ø±ÙŠØ© Ø¨Ø±ÙƒØ§Ù†ÙŠØ©"], choices_en:["A layer that practically prevents water flow (usually clay)","A highly permeable aquifer","A surface river channel","A volcanic rock unit"], answerIndex:0 },
      // ... (ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù€ 27 Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙƒÙ…Ø§ Ù‡ÙŠ)
      { q_ar:"Ù…Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… GIS ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ØŸ", q_en:"Use of GIS in hydrogeology?", choices_ar:["Ø±Ø³Ù… Ø®Ø±Ø§Ø¦Ø· Ø§Ù„ØªØºØ°ÙŠØ©ØŒ Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ù†Ø³ÙˆØ¨ØŒ Ù†Ù…Ø°Ø¬Ø© Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ù…Ù„ÙˆØ«Ø§Øª ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª","Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù† ØªØ­Øª Ø§Ù„Ù…Ø¬Ù‡Ø± ÙÙ‚Ø·","Ù„Ø§ ÙØ§Ø¦Ø¯Ø©","Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Ø§Ù„Ø·Ù‚Ø³ ÙÙ‚Ø·"], choices_en:["Mapping recharge, potentiometric contours, pollutant spread modeling and spatial analysis","Microscopic mineral analysis only","No use","Only for weather uses"], answerIndex:0 }
    ]
  },

  petro: {
    title_ar:"Ø§Ù„Ø¨ØªØ±ÙˆØºØ±Ø§ÙÙŠØ§ â€” Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµØ®ÙˆØ±", title_en:"Petrography â€” Rock ID", icon: "ğŸª¨",
    items: [
      { q_ar:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ù†Ø§Ø±ÙŠØ© Ø§Ù„Ø¬ÙˆÙÙŠØ© ÙˆØ§Ù„Ø³Ø·Ø­ÙŠØ©ØŸ", q_en:"Difference intrusive vs extrusive igneous rocks?", choices_ar:["Ø§Ù„Ø¬ÙˆÙÙŠØ© ØªØ¨Ø±Ø¯ Ø¨Ø¨Ø·Ø¡ Ø¨Ù„ÙˆØ±Ø§Øª ÙƒØ¨ÙŠØ±Ø©ØŒ Ø§Ù„Ø³Ø·Ø­ÙŠØ© ØªØ¨Ø±Ø¯ Ø³Ø±ÙŠØ¹Ø§Ù‹ Ø¨Ù„ÙˆØ±Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©","Ø§Ù„Ø³Ø·Ø­ÙŠØ© Ø£Ù‚Ø¯Ù… Ø¯Ø§Ø¦Ù…Ø§Ù‹","Ø§Ù„Ø¬ÙˆÙÙŠØ© Ù„Ø§ ØªØ­ØªÙˆÙŠ Ù…Ø¹Ø§Ø¯Ù†","Ø§Ù„Ø³Ø·Ø­ÙŠØ© ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø¨Ø­Ø± ÙÙ‚Ø·"], choices_en:["Intrusive cool slowly (large crystals); extrusive cool fast (fine crystals)","Extrusive always older","Intrusive contain no minerals","Extrusive only form in ocean"], answerIndex:0 },
      { q_ar:"Ù…Ø§ Ù…ÙƒÙˆÙ†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„ØµØ®Ø± Ø§Ù„ÙØ§ØªØ­ Ø°Ùˆ Ø§Ù„Ø¨Ù„ÙˆØ±Ø§Øª Ø§Ù„Ø®Ø´Ù†Ø©ØŸ", q_en:"Main components of this coarse-grained, felsic rock?", 
        // --- 10x: Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© (Ø¬Ø±Ø§Ù†ÙŠØª) ---
        image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Granite_G%C3%A4rkam-3.jpg/640px-Granite_G%C3%A4rkam-3.jpg",
        choices_ar:["ÙƒÙˆØ§Ø±ØªØ²ØŒ ÙÙ„Ø³Ø¨Ø§Ø± Ø¨ÙˆØªØ§Ø³ÙŠØŒ Ø¨Ù„Ø§ØºÙŠÙˆÙƒÙ„Ø§Ø² ÙˆÙ…Ù‚Ø¯Ø§Ø± Ù…Ù† Ø§Ù„Ù…ÙŠÙƒØ§","ÙƒÙ„Ø³ÙŠØª ÙˆØ¯ÙˆÙ„ÙˆÙ…ÙŠØª","Ø£ÙˆÙ„ÙŠÙÙŠÙ† ÙˆØ¨ÙŠØ±ÙˆÙƒØ³ÙŠÙ† ÙÙ‚Ø·","Ø·ÙŠÙ† ÙˆØ±Ù…Ù„"], choices_en:["Quartz, K-feldspar, plagioclase and some mica","Calcite and dolomite","Only olivine and pyroxene","Clay and sand"], answerIndex:0 },
      { q_ar:"Ù…Ø§ Ø¯Ù„Ø§Ù„Ø© Ø§Ù„Ù†Ø³ÙŠØ¬ Ø§Ù„Ø¨ÙˆØ±ÙÙŠØ±ÙŠØŸ", q_en:"Significance of porphyritic texture?", choices_ar:["ÙŠØ´ÙŠØ± Ù„ØªØ¨Ø±ÙŠØ¯ Ø¨Ù…Ø±Ø­Ù„ØªÙŠÙ†: Ø¨Ù„ÙˆØ±Ø§Øª ÙƒØ¨ÙŠØ±Ø© Ø«Ù… Ù…ØµÙÙˆÙØ© Ø¯Ù‚ÙŠÙ‚Ø©","Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ÙˆÙ„","Ø¯Ù„Ø§Ù„Ø© Ø¹Ù„Ù‰ ØªØ±Ø³Ø¨ Ø¨Ø­Ø±ÙŠ","Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ ØªØ¢ÙƒÙ„"], choices_en:["Indicates two-stage cooling: large crystals in fine matrix","Evidence of metamorphism","Indicative of marine deposition","Sign of erosion"], answerIndex:0 },
      { q_ar:"ÙƒÙŠÙ ØªÙØ±Ù‚ Ø§Ù„Ø¨Ø§Ø²Ù„Øª (Ù…Ø«Ù„ Ù‡Ø°Ø§) ÙˆØ§Ù„Ø£Ù†Ø¯ÙŠØ²ÙŠØª Ù…ÙŠØ¯Ø§Ù†ÙŠØ§Ù‹ØŸ", q_en:"How distinguish basalt (like this) and andesite in hand sample?", 
        // --- 10x: Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© (Ø¨Ø§Ø²Ù„Øª) ---
        image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Basalt_%286%29.jpg/640px-Basalt_%286%29.jpg",
        choices_ar:["Ø§Ù„Ø¨Ø§Ø²Ù„Øª Ø¯Ø§ÙƒÙ†ØŒ Ø­Ø¨ÙŠØ¨Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©Ø› Ø§Ù„Ø£Ù†Ø¯ÙŠØ²ÙŠØª Ø£ÙØªØ­ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙˆÙ…Ø­ØªÙˆÙŠ ÙÙ„Ø²Ø§Øª Ø£Ù‚Ù„","Ø§Ù„Ø¨Ø§Ø²Ù„Øª ÙØ§ØªØ­ Ø¯Ø§Ø¦Ù…Ø§Ù‹","Ø§Ù„Ø£Ù†Ø¯ÙŠØ²ÙŠØª Ø²Ø¬Ø§Ø¬ÙŠ ÙÙ‚Ø·","Ù„Ø§ ÙØ±Ù‚ Ø¹Ù…Ù„ÙŠØ§Ù‹"], choices_en:["Basalt dark, fine-grained; andesite lighter with intermediate composition","Basalt always light","Andesite only glassy","No practical difference"], answerIndex:0 },
      // ... (ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù€ 26 Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙƒÙ…Ø§ Ù‡ÙŠ)
      { q_ar:"Ù…Ø§ Ù‡Ùˆ Ù…Ø¤Ø´Ø± Ø§Ù„Ù„ÙˆÙ† ÙÙŠ ØªØµÙ†ÙŠÙ Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ù†Ø§Ø±ÙŠØ© (Mafic Index)ØŸ", q_en:"What is the Mafic Index in igneous classification?", choices_ar:["Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù† Ø§Ù„Ù…Ø§ÙÙŠØ© (Ø§Ù„Ø¯Ø§ÙƒÙ†Ø©) Ø¥Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù† ÙÙŠ Ø§Ù„ØµØ®Ø±","Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙŠØ§Ù‡","Ù†Ø³Ø¨Ø© Ø§Ù„ÙƒÙˆØ§Ø±ØªØ² ÙÙ‚Ø·","Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙŠÙƒØ§"], choices_en:["Ratio of mafic (dark) minerals to total minerals in the rock","Water ratio","Quartz ratio only","Mica ratio"], answerIndex:0 }
    ]
  },

  maps: {
    title_ar:"Ø§Ù„Ø®Ø±Ø§Ø¦Ø· Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© â€” Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª", title_en:"Geological Maps â€” Basics", icon: "ğŸ—ºï¸",
    items: [
      { q_ar:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ©ØŸ", q_en:"Difference between geological and topographic maps?", choices_ar:["Ø§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ© ØªÙ…Ø«Ù„ Ø§Ø±ØªÙØ§Ø¹Ø§Øª (ÙƒÙ†ØªÙˆØ±Ø§Øª)ØŒ Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ØªÙ…Ø«Ù„ Ù†ÙˆØ¹ ÙˆØ§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„ØµØ®ÙˆØ± ÙˆØ§Ù„ØªØ±Ø§ÙƒÙŠØ¨","Ø§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ© Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠÙŠÙ† ÙÙ‚Ø·","Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ØªØ¹Ø±Ø¶ Ù…Ù†Ø§Ø® Ø§Ù„Ù…Ù†Ø·Ù‚Ø©","Ù„Ø§ ÙØ±Ù‚"], choices_en:["Topographic shows elevations (contours); geological shows rock types and structures","Topographic for geologists only","Geological shows climate","No difference"], answerIndex:0 },
      { q_ar:"Ù…Ø§ ÙØ§Ø¦Ø¯Ø© Ø®Ø·ÙˆØ· Ø§Ù„ÙƒÙ†ØªÙˆØ±ØŸ", q_en:"Purpose of contour lines?", choices_ar:["ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹Ø§Øª ÙˆØ´ÙƒÙ„ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ ÙˆØ§Ù„Ø§Ù†Ø­Ø¯Ø§Ø±Ø§Øª","ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØµØ®ÙˆØ±","Ù‚ÙŠØ§Ø³ Ø³Ø±Ø¹Ø© Ø§Ù„Ù…ÙŠØ§Ù‡","ØªØ¹Ø±ÙŠÙ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¨Ù„Ø¯"], choices_en:["Show elevations and terrain shape/slopes","Indicate rock type","Measure water speed","Define country borders"], answerIndex:0 },
      { q_ar:"ÙƒÙŠÙ ØªØ­Ø¯Ø¯ Ù…ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©ØŸ", q_en:"How determine dip of beds from map?", choices_ar:["Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§ØªØ¬Ø§Ù‡ ØªÙ‚Ø§Ø·Ø¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù…Ø¹ Ø®Ø·ÙˆØ· Ø§Ù„ÙƒÙ†ØªÙˆØ± ÙˆØ­Ø³Ø§Ø¨ V-rule","Ù…Ù† Ø§Ù„Ù„ÙˆÙ† ÙÙ‚Ø·","Ù…Ù† Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø®Ø±ÙŠØ·Ø©","Ù…Ù† Ø§Ù„ØµÙˆØ± satellit ÙÙ‚Ø·"], choices_en:["By comparing strike lines with contours and using V-rule","By color only","By map scale","From satellite images only"], answerIndex:0 },
      { q_ar:"Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø±Ù…Ø² Ø§Ù„Ø·Ø¨Ù‚Ø© (Ù…Ø«Ù„ Ksh)ØŸ", q_en:"Meaning of unit code (eg Ksh)?", choices_ar:["ÙŠØ´ÙŠØ± Ù„Ù„Ø¹Ù…Ø± ÙˆØ§Ù„ØµØ®Ø± (K=Crete, sh=shale)","Ù‡Ùˆ Ø±Ù…Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠ","ÙŠØ­Ø¯Ø¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹","Ø§Ù„Ù…Ù‚ÙŠØ§Ø³"], choices_en:["Indicates age and rock (e.g., K=Cretaceous, sh=shale)","Random code","Specifies elevation","Scale"], answerIndex:0 },
      // ... (ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù€ 8 Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙƒÙ…Ø§ Ù‡ÙŠ)
      { q_ar:"ÙƒÙŠÙ ØªÙ…ÙŠØ² Ø·ÙŠØ© Ù…Ø­Ø¯Ø¨Ø© (Anticline) Ù…Ù† Ù…Ù‚Ø¹Ø±Ø© (Syncline) Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©ØŸ", q_en:"How tell anticline vs syncline on a map?", 
        // --- 10x: Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© (Ø·ÙŠØ§Øª) ---
        image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Geologic_map_symbols_for_folds.svg/640px-Geologic_map_symbols_for_folds.svg.png",
        choices_ar:["Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø£Ù‚Ø¯Ù… Ø¹Ø§Ø¯Ø© ÙÙŠ Ù…Ø±ÙƒØ² Ø§Ù„Ø·ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¨Ø© ÙˆØ§Ù„Ø£Ø­Ø¯Ø« ÙÙŠ Ø§Ù„Ù…Ù‚Ø¹Ø±Ø©","Ø§Ù„Ù…Ø­Ø¯Ø¨Ø© Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø£Ø¹Ø±Ø¶","Ø§Ù„Ù…Ù‚Ø¹Ø±Ø© Ø£Ù‚Ø¯Ù…","Ù„Ø§ ÙØ±Ù‚"], choices_en:["Older beds usually at center of anticline; younger in syncline","Anticline always broader","Syncline older","No difference"], answerIndex:0 },
      // ... (ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù€ 17 Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙƒÙ…Ø§ Ù‡ÙŠ)
      { q_ar:"ÙƒÙŠÙ ØªÙØ­ÙˆÙ‘Ù„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙˆØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø±Ù‚Ù…ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GISØŸ", q_en:"How convert paper map to digital using GIS?", choices_ar:["Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø³Ø­ (Scanning) Ø«Ù… Ø¹Ù…Ù„ÙŠØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (Georeferencing) ÙˆØ±Ù‚Ù…Ù†Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„","Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ÙÙ‚Ø·","Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ù„Ù… Ø±ØµØ§Øµ ÙÙ‚Ø·","Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø³Ø·Ø±Ø©"], choices_en:["By scanning then georeferencing and digitizing geological details","Using calculator only","Using pencil only","Using ruler"], answerIndex:0 }
    ]
  },

  general: {
    title_ar:"Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø¹Ø§Ù…Ø©", title_en:"General Geology", icon: "ğŸŒ",
    items: [
      { q_ar:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø§Ø¬Ù…Ø§ ÙˆØ§Ù„Ù„Ø§ÙØ§ØŸ", q_en:"Magma vs lava?", choices_ar:["Ø§Ù„Ù…Ø§Ø¬Ù…Ø§ ØªØ­Øª Ø§Ù„Ø³Ø·Ø­ØŒ Ø§Ù„Ù„Ø§ÙØ§ Ø¹Ù†Ø¯ Ø®Ø±ÙˆØ¬Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø­","Ø§Ù„Ù…Ø§Ø¬Ù…Ø§ Ù…Ø§Ø¡ ÙˆØ§Ù„Ù„Ø§ÙØ§ Ø­Ø¬Ø±","Ù„Ø§ ÙØ±Ù‚","Ù…Ø§Ø¬Ù…Ø§ = ØµØ®ÙˆØ± Ù…ØªØ­ÙˆÙ„Ø©"], choices_en:["Magma is subsurface molten rock; lava is magma erupted at surface","Magma is water and lava rock","No difference","Magma = metamorphic rock"], answerIndex:0 },
      { q_ar:"Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØµØ®Ø±ÙŠØ©ØŸ", q_en:"What is the rock cycle?", 
        // --- 10x: Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© (Ø¯ÙˆØ±Ø© Ø§Ù„ØµØ®ÙˆØ±) ---
        image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Rock_cycle.jpg/640px-Rock_cycle.jpg",
        choices_ar:["ØªØ­ÙˆÙ„ Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ù†Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø±Ø³ÙˆØ¨ÙŠØ© ÙˆØ§Ù„Ù…ØªØ­ÙˆÙ„Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©","Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„Ù†Ø¨Ø§Øª ÙÙ‚Ø·","Ø¸Ø§Ù‡Ø±Ø© Ø¬ÙˆÙŠØ©","Ø¹Ù…Ù„ÙŠØ© Ø¨Ø´Ø±ÙŠØ©"], choices_en:["Transformation of igneous, sedimentary and metamorphic rocks via geologic processes","Plant life cycle only","Atmospheric phenomenon","Human activity"], answerIndex:0 },
      // ... (ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù€ 28 Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙƒÙ…Ø§ Ù‡ÙŠ)
      { q_ar:"Ù…Ø§ ÙØ§Ø¦Ø¯Ø© Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ØŸ", q_en:"Value of geology for resources?", choices_ar:["ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¨ØªØ±ÙˆÙ„ØŒ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù†ØŒ ÙˆØ§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¬ÙˆÙÙŠØ© ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù…","ÙÙ‚Ø· Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ù†Ø¸Ø±ÙŠ","Ù„Ø§ ÙØ§Ø¦Ø¯Ø©","ÙÙ‚Ø· Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø·Ø±Ù‚"], choices_en:["Locating petroleum, minerals, groundwater and guiding sustainable use","Only theoretical research","No use","Only for road design"], answerIndex:0 }
    ]
  }
};
// -- 10x: Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ 30 Ø³Ø¤Ø§Ù„ ÙÙŠ ÙƒÙ„ Ù‚Ø³Ù… --
// (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ ÙƒØ§Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 30 Ø³Ø¤Ø§Ù„ Ù„ÙƒÙ„ Ù‚Ø³Ù…ØŒ Ù„Ø°Ø§ Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø¯)


/* ---------- App state ---------- */
let currentSection = null;
let currentIndex = 0;
let currentScore = 0;
let correctCount = 0;
let wrongCount = 0;
let timerSeconds = 30;
let timerInterval = null;
let leaderboard = JSON.parse(localStorage.getItem('geo_leaderboard')||'[]');
let answered = false;
// --- 10x: Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ---
let currentStreak = 0;
let wrongAnswers = []; // Ù„ØªØ®Ø²ÙŠÙ† Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
let settings = JSON.parse(localStorage.getItem('geo_settings')) || { audio: true };
const RESUME_KEY = 'geo_resume_state';

/* ---------- DOM refs ---------- */
const sectionListEl = document.getElementById('sectionList');
const quizArea = document.getElementById('quizArea');
const qLabel = document.getElementById('qLabel');
const qText = document.getElementById('qText');
const answersBox = document.getElementById('answersBox');
const timerLabel = document.getElementById('timerLabel');
const scoreVal = document.getElementById('scoreVal');
const levelBadge = document.getElementById('levelBadge');
const progInner = document.getElementById('progInner');
const progressLabel = document.getElementById('progressLabel');
const skipBtn = document.getElementById('skipBtn');
const backToMenu = document.getElementById('backToMenu');
// --- 10x: DOM refs Ø¬Ø¯ÙŠØ¯Ø© ---
const scorePopupArea = document.getElementById('scorePopupArea');
const streakCounter = document.getElementById('streakCounter');
const qImageContainer = document.getElementById('qImageContainer');
const qImage = document.getElementById('qImage');
const resumePrompt = document.getElementById('resumePrompt');

// Result Modal
const resultModal = document.getElementById('resultModal');
const resScore = document.getElementById('resScore');
const resDetails = document.getElementById('resDetails');
const retryBtn = document.getElementById('retryBtn');
const closeResBtn = document.getElementById('closeResBtn');
const savedNote = document.getElementById('savedNote');
const reviewBtn = document.getElementById('reviewBtn');

// Leaderboard Modal
const leaderBtn = document.getElementById('leaderBtn');
const leaderboardModal = document.getElementById('leaderboardModal');
const leaderboardList = document.getElementById('leaderboardList');

// Review Modal
const reviewModal = document.getElementById('reviewModal');
const reviewList = document.getElementById('reviewList');

// Settings Modal
const settingsBtn = document.getElementById('settingsBtn');
const settingsModal = document.getElementById('settingsModal');
const audioToggle = document.getElementById('audioToggle');
const clearDataBtn = document.getElementById('clearDataBtn');


/* ---------- Audio (WebAudio beeps) ---------- */
const audioCtx = (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') 
  ? new (window.AudioContext || window.webkitAudioContext)() 
  : null;

function beep(freq=880, dur=0.12, type='sine', gain=0.12){
  if (!settings.audio || !audioCtx) return; // --- 10x: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  try{
    if(audioCtx.state === 'suspended') audioCtx.resume();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    setTimeout(()=> { try{ o.stop() }catch(e){} }, dur*1000+30);
  }catch(e){
    console.warn("WebAudio failed:", e);
  }
}
function playCorrect(){ beep(920,0.12,'sine',0.12); }
function playWrong(){ beep(220,0.18,'square',0.14); }
function playStreak(){ beep(1200, 0.08, 'triangle', 0.15); }

/* ---------- Helpers ---------- */
function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
function formatTime(s){ const mm=Math.floor(s/60), ss=s%60; return `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`; }

/* ---------- 10x: Floating Score Popup ---------- */
function showScorePopup(text, type = 'good'){
  const el = document.createElement('div');
  el.className = `score-popup ${type}`;
  el.textContent = text;
  scorePopupArea.appendChild(el);
  setTimeout(()=> el.remove(), 1200);
}

/* ---------- 10x: State Management (Resume) ---------- */
function saveState(){
  if (!currentSection) return;
  const state = { 
    currentSection, 
    currentIndex, 
    currentScore, 
    correctCount, 
    wrongCount,
    currentStreak,
    wrongAnswers 
  };
  localStorage.setItem(RESUME_KEY, JSON.stringify(state));
}
function clearState(){
  localStorage.removeItem(RESUME_KEY);
}
function loadState(state){
  currentSection = state.currentSection;
  currentIndex = state.currentIndex;
  currentScore = state.currentScore;
  correctCount = state.correctCount;
  wrongCount = state.wrongCount;
  currentStreak = state.currentStreak;
  wrongAnswers = state.wrongAnswers;

  quizArea.style.display = 'block';
  sectionListEl.style.display = 'none';
  showQuestion();
}

/* ---------- UI render ---------- */
function renderSectionCards(){
  sectionListEl.innerHTML = '';
  const keys = Object.keys(QUIZZES);
  keys.forEach(k=>{
    const data = QUIZZES[k];
    const card = document.createElement('div'); card.className='section-card';
    card.onclick = ()=> startSection(k);
    card.innerHTML = `
      <div class="section-icon">${data.icon}</div>
      <div>
        <div class="section-title">${lang==='ar'?data.title_ar:data.title_en}</div>
        <div class="section-desc">${lang==='ar'?'30 Ø³Ø¤Ø§Ù„ Ø¹Ù…Ù„ÙŠ â€” ØªØªØ§Ø¨Ø¹ÙŠ':'30 practical Q â€” sequential'}</div>
      </div>`;
    sectionListEl.appendChild(card);
  });
}

/* ---------- Start section ---------- */
function startSection(key){
  clearState(); // --- 10x: Ø§Ù…Ø³Ø­ Ø£ÙŠ Ø­Ø§Ù„Ø© Ø³Ø§Ø¨Ù‚Ø©
  currentSection = key;
  currentIndex = 0;
  currentScore = 0;
  correctCount = 0;
  wrongCount = 0;
  currentStreak = 0; // --- 10x: ØªØµÙÙŠØ± Ø§Ù„Ø³Ù„Ø³Ù„Ø©
  wrongAnswers = []; // --- 10x: ØªØµÙÙŠØ± Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
  
  quizArea.style.display = 'block';
  sectionListEl.style.display = 'none';
  showQuestion();
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ---------- Show question ---------- */
function showQuestion(){
  answered = false;
  const items = QUIZZES[currentSection].items;
  const item = items[currentIndex];
  const n = items.length;
  
  qLabel.textContent = (lang==='ar')? `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentIndex+1} / Q${currentIndex+1}` : `Q${currentIndex+1} / Question ${currentIndex+1}`;
  qText.textContent = (lang==='ar')? item.q_ar : item.q_en;
  progressLabel.textContent = t('questionOf', {i: currentIndex+1, n});
  
  // --- 10x: Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ ---
  if(item.image_url) {
    qImage.src = item.image_url;
    qImageContainer.style.display = 'block';
  } else {
    qImageContainer.style.display = 'none';
  }
  
  answersBox.innerHTML = '';
  const choices = (lang==='ar')? item.choices_ar.slice() : item.choices_en.slice();
  const opts = choices.map((c,i)=>({text:c,origIndex:i}));
  shuffleArray(opts);
  
  opts.forEach((opt, idx)=>{
    const el = document.createElement('div'); el.className='answer';
    el.innerHTML = `<div class="opt-label">${['A','B','C','D'][idx]}</div><div class="opt-text">${opt.text}</div>`;
    el.dataset.orig = opt.origIndex;
    el.onclick = ()=> selectAnswer(el, item);
    answersBox.appendChild(el);
  });
  
  // UI updates
  progInner.style.width = `${Math.round(((currentIndex+1)/n)*100)}%`;
  scoreVal.textContent = currentScore;
  updateLevelBadge();
  updateStreakCounter();
  
  // Timer
  startTimer();
  
  // Visual
  const card = document.getElementById('questionCard');
  card.classList.remove('fade-in'); void card.offsetWidth; card.classList.add('fade-in');
  
  // --- 10x: Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ ---
  saveState();
}

/* ---------- Answer selection ---------- */
function selectAnswer(el, item){
  if(answered) return;
  answered = true;
  stopTimer();
  
  const chosenOrig = Number(el.dataset.orig);
  const correctIndex = item.answerIndex;
  const isCorrect = (chosenOrig === correctIndex);
  
  let points = 0;
  
  if(isCorrect){
    // --- 10x: Ù…Ù†Ø·Ù‚ Ø§Ù„Ø³Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ---
    currentStreak++;
    let basePoints = 10;
    let bonus = Math.min(10, (currentStreak - 1) * 2); // ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø¨ÙˆÙ†Øµ Ù…Ù† Ø§Ù„Ø³Ù„Ø³Ù„Ø© 2
    points = basePoints + bonus;
    currentScore += points;
    correctCount++;
    
    el.classList.add('correct', 'pulse');
    playCorrect();
    if(currentStreak > 1) {
      setTimeout(playStreak, 100);
      showScorePopup(`+${points} (ğŸ”¥${currentStreak})`, 'good');
    } else {
      showScorePopup(`+${points}`, 'good');
    }
    
  } else {
    // --- 10x: ÙƒØ³Ø± Ø§Ù„Ø³Ù„Ø³Ù„Ø© ---
    currentStreak = 0;
    points = -5; // Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø©
    currentScore = Math.max(0, currentScore + points); // Ù„Ø§ ØªÙ†Ø²Ù„ ØªØ­Øª Ø§Ù„ØµÙØ±
    wrongCount++;
    
    el.classList.add('wrong', 'shake');
    playWrong();
    showScorePopup(`${points}`, 'bad');
    
    // --- 10x: Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ---
    wrongAnswers.push({ 
      q_ar: item.q_ar, q_en: item.q_en,
      choices_ar: item.choices_ar, choices_en: item.choices_en,
      chosen: chosenOrig,
      answerIndex: correctIndex
    });
    
    // Highlight correct option
    Array.from(answersBox.children).forEach(ch=>{
      if(Number(ch.dataset.orig) === correctIndex) ch.classList.add('correct');
      ch.onclick = null;
    });
  }
  
  scoreVal.textContent = currentScore;
  updateLevelBadge();
  updateStreakCounter();
  
  setTimeout(()=> goNext(), 900);
}

/* ---------- Skip (unanswered) ---------- */
skipBtn.addEventListener('click', ()=>{
  if(!currentSection || answered) return;
  answered = true;
  stopTimer();
  
  // --- 10x: ÙƒØ³Ø± Ø§Ù„Ø³Ù„Ø³Ù„Ø© ÙˆÙ…Ø¹Ø§Ù…Ù„ØªÙ‡ ÙƒØ®Ø·Ø£ (Ø¨Ø¯ÙˆÙ† Ø¹Ù‚ÙˆØ¨Ø© Ù†Ù‚Ø§Ø·) ---
  currentStreak = 0;
  wrongCount++;
  showScorePopup(`0`, 'bad');
  updateStreakCounter();
  
  const item = QUIZZES[currentSection].items[currentIndex];
  const correctIndex = item.answerIndex;

  // --- 10x: Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ---
  wrongAnswers.push({ 
    q_ar: item.q_ar, q_en: item.q_en,
    choices_ar: item.choices_ar, choices_en: item.choices_en,
    chosen: -1, // -1 ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¬Ø§ÙˆØ²
    answerIndex: correctIndex
  });

  Array.from(answersBox.children).forEach(ch=>{
    if(Number(ch.dataset.orig) === correctIndex) ch.classList.add('correct');
    ch.onclick = null;
  });
  
  setTimeout(()=> goNext(), 700);
});

/* ---------- Timer ---------- */
function startTimer(){
  let tleft = timerSeconds || 30;
  timerLabel.textContent = formatTime(tleft);
  timerLabel.classList.remove('timer-warn');
  
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    tleft--;
    timerLabel.textContent = formatTime(tleft);
    
    // --- 10x: ØªØ­Ø°ÙŠØ± Ø§Ù„Ù…Ø¤Ù‚Øª ---
    if(tleft <= 10) {
      timerLabel.classList.add('timer-warn');
      if(tleft <= 5) beep(440, 0.08, 'sawtooth', 0.05); // ØµÙˆØª ØªØ­Ø°ÙŠØ± Ø®Ø§ÙØª
    }
    
    if(tleft <= 0){
      clearInterval(timerInterval);
      if(!answered){
        answered = true;
        // --- 10x: Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª ÙƒØ®Ø·Ø£ ---
        playWrong();
        currentStreak = 0;
        currentScore = Math.max(0, currentScore - 5); // Ø¹Ù‚ÙˆØ¨Ø©
        wrongCount++;
        showScorePopup('-5', 'bad');
        
        scoreVal.textContent = currentScore;
        updateLevelBadge();
        updateStreakCounter();
        
        const item = QUIZZES[currentSection].items[currentIndex];
        const corr = item.answerIndex;
        // --- 10x: Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ---
        wrongAnswers.push({ 
          q_ar: item.q_ar, q_en: item.q_en,
          choices_ar: item.choices_ar, choices_en: item.choices_en,
          chosen: -2, // -2 ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
          answerIndex: corr
        });
        
        Array.from(answersBox.children).forEach(ch=>{
          if(Number(ch.dataset.orig) === corr) ch.classList.add('correct');
          ch.onclick = null;
        });
        setTimeout(()=> goNext(), 900);
      }
    }
  },1000);
}
function stopTimer(){ 
  if(timerInterval) clearInterval(timerInterval); 
  timerInterval = null; 
  timerLabel.classList.remove('timer-warn');
}

/* ---------- Next question / finish ---------- */
function goNext(){
  stopTimer();
  const total = QUIZZES[currentSection].items.length;
  currentIndex++;
  if(currentIndex < total){
    showQuestion();
  } else {
    finishQuiz();
  }
}

/* ---------- Finish quiz ---------- */
function finishQuiz(){
  quizArea.style.display = 'none';
  stopTimer();
  clearState(); // --- 10x: Ù…Ø³Ø­ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù
  
  const totalQuestions = QUIZZES[currentSection].items.length;
  const totalPossible = totalQuestions * 10; // (Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø¨ÙˆÙ†Øµ)
  const percent = Math.max(0, Math.round((correctCount / totalQuestions) * 100));
  
  resScore.textContent = `${currentScore} ${t('points')}`;
  resDetails.innerHTML = `
    <div>${t('section')}: <strong>${lang==='ar'?QUIZZES[currentSection].title_ar:QUIZZES[currentSection].title_en}</strong></div>
    <div style="margin-top:8px">${t('correct')}: <strong>${correctCount}/${totalQuestions}</strong></div>
    <div>${t('wrongSkipped')}: <strong>${wrongCount}</strong></div>
    <div style="margin-top:8px">${t('percent')}: <strong>${percent}%</strong></div>
  `;
  const level = determineLevel(currentScore);
  document.getElementById('resTitle').textContent = `${t('finalResult')} â€” ${level.name}`;
  
  // save result
  const entry = { id: Date.now(), section: currentSection, score: currentScore, when: new Date().toISOString(), level: level.name, lang };
  leaderboard.push(entry); leaderboard.sort((a,b)=> b.score - a.score);
  if(leaderboard.length>100) leaderboard = leaderboard.slice(0,100);
  localStorage.setItem('geo_leaderboard', JSON.stringify(leaderboard));
  
  savedNote.textContent = t('savedNote');
  
  // --- 10x: Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ---
  reviewBtn.style.display = (wrongAnswers.length > 0) ? 'inline-block' : 'none';
  
  resultModal.style.display = 'flex';
}

/* ---------- Levels ---------- */
function determineLevel(score){
  if(score >= 250) return { name: t('expert'), color:'#ffd700' };
  if(score >= 150) return { name: t('fieldPro'), color:'#c0c0c0' };
  if(score >= 50) return { name: t('advanced'), color:'#7dd3fc' };
  return { name: t('beginner'), color:'#94a3b8' };
}
function updateLevelBadge(){ const lv = determineLevel(currentScore); levelBadge.textContent = `${t('level')}: ${lv.name}`; }

/* ---------- 10x: Streak Counter ---------- */
function updateStreakCounter(){
  if(currentStreak > 1){
    streakCounter.textContent = `ğŸ”¥ ${currentStreak} ${t('streak')}`;
    streakCounter.classList.add('visible');
  } else {
    streakCounter.classList.remove('visible');
  }
}

/* ---------- Retry / close ---------- */
retryBtn.addEventListener('click', ()=> { resultModal.style.display='none'; startSection(currentSection); });
closeResBtn.addEventListener('click', ()=> { resultModal.style.display='none'; quizArea.style.display='none'; sectionListEl.style.display='grid'; });

/* ---------- Back to menu ---------- */
backToMenu.addEventListener('click', ()=> { 
  // 10x: Ù„Ø§ ÙŠÙ…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø©ØŒ ÙÙ‚Ø· ÙŠØ¹ÙˆØ¯ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
  quizArea.style.display='none'; 
  sectionListEl.style.display='grid'; 
  stopTimer(); 
});

/* ---------- 10x: Leaderboard Modal ---------- */
leaderBtn.addEventListener('click', ()=>{
  const board = JSON.parse(localStorage.getItem('geo_leaderboard')||'[]');
  if(board.length===0){ 
    leaderboardList.innerHTML = `<div style="padding:20px; color:var(--muted);">${t('leaderboardEmpty')}</div>`;
  } else {
    let out = '';
    board.slice(0,20).forEach((e,i)=>{
      const title = (lang==='ar'? QUIZZES[e.section].title_ar : QUIZZES[e.section].title_en);
      out += `
        <div class="leaderboard-item">
          <div class="score">${e.score}</div>
          <div class="details">
            <div class="title">${i+1}. ${title}</div>
            <div class="date">${e.level} â€” ${new Date(e.when).toLocaleDateString(lang)}</div>
          </div>
        </div>`;
    });
    leaderboardList.innerHTML = out;
  }
  leaderboardModal.style.display = 'flex';
});
document.getElementById('closeLeaderBtn').addEventListener('click', ()=> leaderboardModal.style.display='none');

/* ---------- 10x: Review Answers Modal ---------- */
reviewBtn.addEventListener('click', ()=>{
  reviewList.innerHTML = '';
  let out = '';
  wrongAnswers.forEach(item => {
    const qText = (lang === 'ar') ? item.q_ar : item.q_en;
    const choices = (lang === 'ar') ? item.choices_ar : item.choices_en;
    let chosenText = '';
    if (item.chosen === -1) chosenText = `(${t('skip')})`;
    else if (item.chosen === -2) chosenText = `(${t('timer') || 'Time Out'})`;
    else chosenText = choices[item.chosen];
    
    const correctText = choices[item.answerIndex];

    out += `
      <div class="review-item">
        <div class="q-text">${qText}</div>
        <div class="r-ans"><b>${t('yourAnswer')}:</b> ${chosenText}</div>
        <div class="c-ans"><b>${t('correctAnswer')}:</b> ${correctText}</div>
      </div>
    `;
  });
  reviewList.innerHTML = out;
  resultModal.style.display = 'none';
  reviewModal.style.display = 'flex';
});
document.getElementById('closeReviewBtn').addEventListener('click', ()=>{
  reviewModal.style.display = 'none';
  resultModal.style.display = 'flex'; // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
});


/* ---------- 10x: Settings Modal ---------- */
settingsBtn.addEventListener('click', ()=>{
  audioToggle.checked = settings.audio;
  settingsModal.style.display = 'flex';
});
audioToggle.addEventListener('change', (e)=>{
  settings.audio = e.target.checked;
  localStorage.setItem('geo_settings', JSON.stringify(settings));
});
clearDataBtn.addEventListener('click', ()=>{
  if(confirm(t('clearDataConfirm'))){
    localStorage.removeItem('geo_leaderboard');
    localStorage.removeItem(RESUME_KEY);
    localStorage.removeItem('geo_lang');
    localStorage.removeItem('geo_settings');
    location.reload();
  }
});
document.getElementById('closeSettingsBtn').addEventListener('click', ()=> settingsModal.style.display='none');


/* ---------- Language Toggle ---------- */
langToggle.addEventListener('click', () => {
    lang = (lang === 'ar') ? 'en' : 'ar';
    localStorage.setItem('geo_lang', lang);
    document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';
    refreshLangUI();
    renderSectionCards();
    updateLevelBadge();
    if (quizArea.style.display === 'none') {
        sectionListEl.style.display = 'grid';
    }
});

/* ---------- Init ---------- */
function init(){
  document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';
  settings.audio = audioToggle.checked; // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
  
  refreshLangUI();
  renderSectionCards();
  scoreVal.textContent = '0';
  updateLevelBadge();
  sectionListEl.style.display = 'grid';
  
  // --- 10x: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹Ù„Ù‚ ---
  const resumeState = localStorage.getItem(RESUME_KEY);
  if(resumeState){
    resumePrompt.style.display = 'flex';
    document.getElementById('resumeYes').onclick = () => {
      loadState(JSON.parse(resumeState));
      resumePrompt.style.display = 'none';
    };
    document.getElementById('resumeNo').onclick = () => {
      clearState();
      resumePrompt.style.display = 'none';
    };
  }

  // resume audio on gesture
  document.addEventListener('click', ()=> { 
    if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); 
  }, { once:true });
}
init();

</script>
</body>
</html>
