<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GeoQuest! â€” ØªØ­Ø¯ÙŠ Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ Ø§Ù„Ù…Ø­ØªØ±Ù</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;800;900&family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  /* ---------------------------------------------------------------------- */
  /* GeoReady Pallet (Ø§Ù„Ø¬Ø¯ÙŠØ¯) Ùˆ Typography */
  /* ---------------------------------------------------------------------- */
  :root{
    /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    --bg-dark: #1E293B; /* Ø±Ù…Ø§Ø¯ÙŠ ØµØ®Ø±ÙŠ ØºØ§Ù…Ù‚ */
    --bg-light: #F8FAFC; /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© (Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ) */
    --accent-sky: #0EA5E9; /* Ø£Ø²Ø±Ù‚ Ù…Ø§Ø¦ÙŠ (Accent) */
    --accent-sand: #FACC15; /* Ø°Ù‡Ø¨ÙŠ Ø±Ù…Ù„ÙŠ (Secondary Accent) */
    --text-light: #FFFFFF;
    --text-dark: #1E293B;
    --muted: #94A3B8;

    --card: #2D3A4F; /* Ù„ÙˆÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    --accent1: var(--accent-sky);
    --accent2: var(--accent-sand);
    --good: #10B981; /* Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø¬Ø§Ø­ */
    --bad: #EF4444; /* Ø£Ø­Ù…Ø± Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡ */
    --glass: rgba(255,255,255,0.03);
    
    /* Ø§Ù„Ø®Ø·ÙˆØ· */
    --font-arabic: 'Cairo', sans-serif;
    --font-latin: 'Poppins', sans-serif;
  }
  /* ÙˆØ¶Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ: Dark Mode */
  body{
      margin:0;
      font-family: var(--font-arabic), var(--font-latin);
      background: var(--bg-dark);
      color: var(--text-light);
      direction:rtl;
      transition: background-color 0.5s, color 0.5s;
      overflow-y: scroll; 
  }
  .wrap{max-width:1200px;margin:0 auto;padding:0 12px}
  
  /* Light Mode Toggle */
  body.light{
      --bg-dark: var(--bg-light);
      --card: #FFFFFF;
      --text-light: #1E293B;
      --text-dark: #1E293B;
      --muted: #4B5563;
      --accent-sky: #0EA5E9;
      --accent-sand: #CA9E27;
      background: var(--bg-dark);
      color: var(--text-light);
  }
  
  /* ---------------------------------------------------------------------- */
  /* Navbar (Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ) */
  /* ---------------------------------------------------------------------- */
  .navbar{
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(5px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
  }
  .navbar .wrap{
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
  }
  .navbar .logo-text{
      font-size: 20px;
      font-weight: 900;
      color: var(--accent-sky);
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      min-width: 150px;
  }
  .navbar .nav-links a {
      color: var(--muted);
      text-decoration: none;
      margin: 0 15px;
      font-weight: 600;
      transition: color 0.3s;
      font-family: var(--font-latin); 
  }
  .navbar .nav-links a.active, .navbar .nav-links a:hover {
      color: var(--accent-sand);
  }
  .navbar .actions { display: flex; align-items: center; gap: 10px; }
  .navbar .icon-btn {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 1.2em;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
  }
  @media (max-width: 800px) { .navbar .nav-links { display: none; } }
  
  .start-mission-btn{
      background: var(--accent-sand);
      color: var(--text-dark);
      font-weight: 700;
      padding: 8px 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(250, 204, 21, 0.4);
      transition: background 0.3s, transform 0.2s;
  }
  .start-mission-btn:hover { background: #FFD700; transform: translateY(-2px); }
  
  /* ---------------------------------------------------------------------- */
  /* Hero Section (Home Page) */
  /* ---------------------------------------------------------------------- */
  .hero-section{
      height: 70vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      /* Ø®Ù„ÙÙŠØ© ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ø¨Ø§Ù†ÙˆØ±Ø§Ù…Ø§ */
      background: linear-gradient(rgba(30, 41, 59, 0.8), rgba(30, 41, 59, 0.95)), url('https://via.placeholder.com/1200x800/2D3A4F/FACC15?text=GeoReady+Field+Panorama') center/cover;
      transition: all 0.5s;
      border-radius: 12px;
      margin: 20px 0;
  }
  .hero-text h2{ font-size: 2.5em; color: var(--text-light); margin-bottom: 10px; font-weight: 900; }
  .hero-text p{ font-size: 1.1em; color: var(--muted); max-width: 600px; margin-bottom: 30px; }
  .hero-actions .btn-group button { margin: 0 8px; }

  /* ---------------------------------------------------------------------- */
  /* General Content Layout (Page Wrapper) */
  /* ---------------------------------------------------------------------- */
  .page-wrapper { min-height: 80vh; padding: 20px 0; }
  .page-title { font-size: 2.2em; font-weight: 800; color: var(--accent-sky); margin-bottom: 20px; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
  .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
  .geo-card {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.4);
      border-left: 5px solid var(--accent-sand);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
  }
  .geo-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
  .card-header { font-size: 1.5em; font-weight: 700; color: var(--accent-sky); margin-bottom: 10px; }
  .card-meta { color: var(--muted); font-size: 0.9em; margin-top: 5px; }
  .geo-card button { margin-top: 15px; }
  
  /* Utility Classes (Buttons and Fonts) */
  .btn{
      background: var(--accent-sky);
      color: var(--text-light);
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.3s;
      font-family: var(--font-arabic);
  }
  .btn.secondary{ background: var(--accent-sand); color: var(--text-dark); }
  .btn:hover{ background: #00BFFF; }
  .btn-group button { margin: 0 5px; }
  
  /* ---------------------------------------------------------------------- */
  /* Footer (Ø§Ù„Ø°ÙƒÙŠ) */
  /* ---------------------------------------------------------------------- */
  footer{
      background: var(--card);
      padding: 20px 0;
      margin-top: 30px;
      text-align: center;
      border-top: 1px solid rgba(255,255,255,0.1);
  }
  footer .quick-links a{
      color: var(--muted);
      margin: 0 10px;
      text-decoration: none;
      font-size: 0.9em;
  }
  .motto {
      font-style: italic;
      color: var(--accent-sand);
      margin-top: 10px;
  }
  /* ---------------------------------------------------------------------- */
  /* Quiz/Training/Profile Styles */
  /* ---------------------------------------------------------------------- */
  .container{background:var(--card);border-radius:12px;padding:15px;box-shadow:0 8px 30px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.05); margin-top: 20px;}
  .quiz-area{margin-top:8px;min-height:300px;position:relative;overflow:hidden}
  .question-card{background:var(--bg-dark);padding:14px;border-radius:8px;border:1px solid rgba(255,255,255,0.03); box-shadow:0 4px 20px rgba(0,0,0,0.4);}
  .question-text{font-size:16px;font-weight: bold; margin:15px 0 10px; padding:10px; border-right:3px solid var(--accent-sky);}
  .answers{display:flex;flex-direction:column;gap:10px}
  .answer{background:var(--card);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);cursor:pointer;transition:transform .15s,background .15s;display:flex;align-items:center;gap:10px; font-size:14px}
  .answer:hover{transform:translateY(-2px); background:rgba(255,255,255,0.08);}
  .answer.correct { background: var(--good); color: var(--text-light); }
  .answer.wrong { background: var(--bad); color: var(--text-light); }
  .timer{font-weight:900;padding:6px 12px;border-radius:8px;background:var(--bad); color:var(--text-light); min-width:65px; text-align:center; font-size:16px; box-shadow:0 2px 5px rgba(166,86,40,0.5);}
  .controls-bottom{display:flex;gap:6px;align-items:center;margin-top:10px; flex-wrap:wrap; justify-content:space-between}
  .controls-bottom .ghost { flex-grow:1; }

  /* ØªÙ†Ø³ÙŠÙ‚ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ */
  #trainingContent {
      padding: 15px;
      margin-top: 15px;
      border-radius: 8px;
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.05);
  }
  #trainingContent h2 { color: var(--accent-sky); font-size: 1.2em; border-bottom: 1px dashed rgba(255,255,255,0.1); padding-bottom: 5px; margin-top: 1.5em; font-weight: 700; }
  #trainingContent ul { padding-right: 25px; list-style-type: 'ğŸª¨ '; line-height: 1.8; }
  #trainingContent table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
  #trainingContent th, #trainingContent td { border: 1px solid rgba(255,255,255,0.1); padding: 8px; text-align: right; }
  #trainingContent th { background: rgba(255,255,255,0.05); color: var(--accent-sand); }
  .math { direction: ltr; text-align: left; }
</style>
</head>
<body>

  <nav class="navbar">
    <div class="wrap">
      <div class="logo-text" onclick="renderPage('home')">ğŸª¨ GeoQuest!</div>
      <div class="nav-links">
        <a href="#" onclick="renderPage('home')" data-page="home" class="active" id="nav-home">Home</a>
        <a href="#" onclick="renderPage('missions')" data-page="missions" id="nav-missions">Missions</a>
        <a href="#" onclick="renderPage('tools')" data-page="tools" id="nav-tools">Tools</a>
        <a href="#" onclick="renderPage('learn')" data-page="learn" id="nav-learn">Learn</a>
        <a href="#" onclick="renderPage('reports')" data-page="reports" id="nav-reports">Reports</a>
        <a href="#" onclick="renderPage('profile')" data-page="profile" id="nav-profile">Profile</a>
      </div>
      <div class="actions">
        <button class="start-mission-btn" onclick="renderPage('missions')">â†’ ğŸ”˜ Start Mission</button>
        <button class="icon-btn" id="modeToggle">ğŸŒ™</button>
      </div>
    </div>
  </nav>

  <main class="wrap" id="mainAppContent">
    
    <div class="page-wrapper" id="page-home">
        <div class="hero-section">
            <div class="hero-text">
                <h2>Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ¬ Ø¥Ù„Ù‰ Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ Ø¬Ø§Ù‡Ø².</h2>
                <p>Ø§Ø®ØªØ¨Ø±ØŒ Ø§Ø­ÙØ±ØŒ Ø§Ø­Ù„Ù„ØŒ ÙˆÙƒÙ† Ù…Ø­ØªØ±ÙÙ‹Ø§ ÙÙŠ Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©.</p>
                <div class="hero-actions btn-group">
                    <button class="btn" onclick="renderPage('missions')">Ø§Ø¨Ø¯Ø£ Ù…Ù‡Ù…Ø©</button>
                    <button class="btn secondary" onclick="renderPage('learn')">ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</button>
                </div>
            </div>
        </div>
        
        <h3 class="page-title" style="font-size: 1.5em; border-bottom: none;">ğŸ§­ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h3>
        <div class="card-grid">
            <div class="geo-card" onclick="startSection('petro')">
                <div class="card-header">ğŸŒ‹ ÙˆØµÙ Ù†ÙˆØ§Ø© Ø§Ù„Ø­ÙØ±</div>
                <div class="card-meta">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Beginner</div>
            </div>
            <div class="geo-card" onclick="startSection('hydro')">
                <div class="card-header">ğŸ’§ ØªÙ‚ÙŠÙŠÙ… Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¬ÙˆÙÙŠØ©</div>
                <div class="card-meta">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Advanced</div>
            </div>
            <div class="geo-card" onclick="renderPage('tools')">
                <div class="card-header">ğŸ§® Ø­Ø§Ø³Ø¨Ø© Ø³Ø±Ø¹Ø© Ø§Ù„Ø­ÙØ± (ROP)</div>
                <div class="card-meta">Ø£Ø¯Ø§Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ© Ø³Ø±ÙŠØ¹Ø©</div>
            </div>
        </div>
    </div>

    <div class="page-wrapper" id="page-missions" style="display:none;">
        <h1 class="page-title">ğŸ§­ Missions (Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©)</h1>
        <p style="color:var(--muted);">Ø§Ø®ØªØ± Ù…Ù‡Ù…Ø© Ù„ØªØ­Ø¯ÙŠ Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ… ÙÙˆØ±ÙŠ ÙˆÙ†Ù‚Ø§Ø· Ø®Ø¨Ø±Ø©.</p>
        
        <h3 style="margin-top: 40px; color: var(--accent-sand);">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Quizzes)</h3>
        <div class="sections" id="sectionList" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
          </div>
    </div>

    <div class="page-wrapper" id="page-tools" style="display:none;">
        <h1 class="page-title">ğŸ§® Tools (Ø­Ø§Ø³Ø¨Ø§Øª ÙˆÙ…Ø³Ø§Ø¹Ø¯Ø§Øª Ù…ÙŠØ¯Ø§Ù†ÙŠØ©)</h1>
        <p style="color:var(--muted);">Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ùƒ Ù‡Ù†Ø§ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.</p>
        <div class="card-grid">
            <div class="geo-card">
                <div class="card-header">ROP Calculator (Ø³Ø±Ø¹Ø© Ø§Ù„Ø­ÙØ±)</div>
                <div class="card-meta">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù…Ù‚ (Ù…) ÙˆØ§Ù„ÙˆÙ‚Øª (Ø³).</div>
            </div>
            <div class="geo-card">
                <div class="card-header">Porosity Calculator (Ø§Ù„Ù…Ø³Ø§Ù…ÙŠØ©)</div>
                <div class="card-meta">ÙŠØ­ØªØ§Ø¬ Ø­Ø¬Ù… Ø§Ù„ÙØ±Ø§ØºØ§Øª ÙˆØ§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒÙ„ÙŠ.</div>
            </div>
            <div class="geo-card">
                <div class="card-header">Darcy Flow Calculator</div>
                <div class="card-meta">ÙŠØ­Ø³Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¬Ø±ÙŠØ§Ù† Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆÙ„ÙŠÙƒÙŠ.</div>
            </div>
            <div class="geo-card">
                <div class="card-header">Water Quality Index (WQI)</div>
                <div class="card-meta">ØªÙ‚ÙŠÙŠÙ… Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„.</div>
            </div>
            <div class="geo-card">
                <div class="card-header">Compass & Strike-Dip Simulation</div>
                <div class="card-meta">Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨ÙˆØµÙ„Ø© ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ù„Ù…ÙŠÙ„.</div>
            </div>
        </div>
    </div>

    <div class="page-wrapper" id="page-learn" style="display:none;">
        <h1 class="page-title">ğŸ“˜ Learn (Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© GeoReady)</h1>
        <p style="color:var(--muted);">Ø¯Ø±ÙˆØ³ Ù‚ØµÙŠØ±Ø© ÙˆÙ…Ø±ÙƒØ²Ø© Ù„ØªØ¹Ø²ÙŠØ² Ù…Ø¹Ø±ÙØªÙƒ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©.</p>
        <div style="display:flex; gap:10px; margin-bottom: 20px;">
            <button class="btn secondary" style="padding: 8px 15px;">ğŸª¨ Petrology</button>
            <button class="btn" style="padding: 8px 15px;">ğŸ’§ Hydrogeology</button>
            <button class="btn secondary" style="padding: 8px 15px;">ğŸŒ‹ Structural</button>
        </div>
        
        <div class="card-grid" id="learn-content-grid">
             </div>
        <div id="trainingContent" class="container" style="display:none;"></div>
    </div>
    
    <div class="page-wrapper" id="page-reports" style="display:none;">
        <h1 class="page-title">ğŸ“„ Reports (Ù†Ù…Ø§Ø°Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙŠØ¯Ø§Ù†ÙŠØ©)</h1>
        <div class="geo-card">
             <div class="card-header">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ÙØ­Øµ Ø¨Ø¦Ø± Ø¬Ø¯ÙŠØ¯</div>
             <p style="color:var(--muted);">Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± PDF Ø¬Ø§Ù‡Ø² Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨Ø´Ø¹Ø§Ø± GeoReady.</p>
             <div style="margin-top: 15px;">
                 <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©" style="width:100%; padding:10px; margin-bottom:10px; background:var(--bg-dark); border:1px solid rgba(255,255,255,0.1); color:var(--text-light); border-radius:4px;">
                 <textarea placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ù‚Ù„ ÙˆØ§Ù„Ø·Ø¨Ù‚Ø§Øª (From - To)" rows="5" style="width:100%; padding:10px; margin-bottom:10px; background:var(--bg-dark); border:1px solid rgba(255,255,255,0.1); color:var(--text-light); border-radius:4px;"></textarea>
                 <button class="btn secondary">ØªØµØ¯ÙŠØ± PDF</button>
             </div>
        </div>
    </div>
    
    <div class="page-wrapper" id="page-profile" style="display:none;">
        <h1 class="page-title">ğŸ‘¤ Profile (Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ)</h1>
        <div class="card-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
            <div class="geo-card" style="border-left: 5px solid var(--accent-sky);">
                <div class="card-header">ğŸ§­ Geologist User</div>
                <div class="card-meta">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!</div>
                <p style="font-size: 2em; font-weight: 900; color: var(--accent-sand);" id="profileTotalScore">0 XP</p>
                <div class="card-meta" id="profileLevel">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Trainee 1</div>
                <button class="btn secondary" style="font-size: 13px;">ğŸ”— Ø´Ø§Ø±Ùƒ Ù…Ù„ÙÙŠ</button>
            </div>
            
            <div class="geo-card">
                <div class="card-header">ğŸ–ï¸ Ø§Ù„Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</div>
                <div class="card-meta">Ø£Ø¸Ù‡Ø± Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ!</div>
                <div class="badges-grid" id="profileBadgesGrid" style="justify-content: flex-start; margin-top: 10px; display: flex; flex-wrap: wrap; gap: 8px;">
                    </div>
            </div>
            <div class="geo-card" style="grid-column: 1 / -1;">
                <div class="card-header">ğŸ“ Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø©</div>
                <ul id="completedMissionsList" style="list-style: none; padding: 0;">
                    <li style="color: var(--muted);">Ù„Ù… ØªÙ†Ø¬Ø² Ø£ÙŠ Ù…Ù‡Ù…Ø© Ø¨Ø¹Ø¯...</li>
                </ul>
            </div>
        </div>
    </div>
    
    <section class="quiz-area container" id="quizArea" style="display:none">
        <div class="question-card" id="questionCard">
          <div class="question-meta">
            <div class="qnum" id="qLabel">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 / Q1</div>
            <div style="display:flex;gap:12px;align-items:center">
              <div class="scorebox">
                <div class="small-muted" id="scoreLabel">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                <div class="score-value" id="scoreVal">0</div>
                <div class="level-badge" id="levelBadge">Ù…Ø¨ØªØ¯Ø¦</div>
              </div>
              <div class="timer" id="timerLabel">00:30</div>
            </div>
          </div>

          <div class="question-text" id="qText">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ â€¦</div>
          <div class="answers" id="answersBox"></div>

          <div class="controls-bottom" style="border-top:1px solid rgba(255,255,255,0.05); padding-top:12px;">
            <div style="display:flex; align-items:center; gap:8px;">
                <div class="small-muted" id="progressLabel">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 30</div>
                <div class="progress-bar" style="width:100px; height:8px;"><div id="progInner"></div></div>
            </div>
            <button class="ghost" id="backToMenu">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            <button class="ghost" id="skipBtn" style="flex-grow:0; min-width:80px;">ØªØ¬Ø§ÙˆØ²</button>
          </div>
        </div>
    </section>
  </main>
  
  <footer>
      <div class="quick-links">
          <a href="#">About GeoQuest</a>
          <a href="#">Contact</a>
          <a href="#">Privacy</a>
      </div>
      <div class="logo-text" style="justify-content: center; margin-top: 10px;">ğŸª¨ GeoQuest!</div>
      <p class="motto">GeoReady â€“ Ø­ÙŠØ« ÙŠØªØ­ÙˆÙ„ Ø§Ù„Ø®Ø±ÙŠØ¬ Ø¥Ù„Ù‰ Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ.</p>
  </footer>

  <div id="resultModal" class="result-panel" style="display:none">
    <div class="result-card">
      <h2 id="resTitle">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
      <div class="bigscore" id="resScore">0 Ù†Ù‚Ø·Ø©</div>
      <div class="res-details" id="resDetails"></div>
      <div class="res-actions">
        <button class="btn" id="retryBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        <button class="ghost" id="closeResBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div style="margin-top:10px" class="small-muted" id="savedNote"></div>
    </div>
  </div>


<script>
/* ---------------------------------------------------------------------- */
/* GeoQuest! Application Logic (JS) - All data and functions */
/* ---------------------------------------------------------------------- */

document.body.style.fontFamily = `'Cairo', 'Poppins', sans-serif`;

// --- Configuration Data (Full Content Re-integrated) ---
const FULL_TRAINING_SECTIONS = [
  { id: 'intro', icon: 'ğŸ§­', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 1 â€” Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ', quiz_key: 'general', content: `<h2>ğŸ“˜ Ø§Ù„Ø´Ø±Ø­ Ø§Ù„ÙƒØ§Ù…Ù„</h2>Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ Ù‡Ùˆ **Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„Ø¹Ù„Ù…ÙŠØ©** Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¶ÙŠØ©. ÙˆØ¸ÙŠÙØªÙ‡ ØªØ¨Ø¯Ø£ Ù…Ù† Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙ†ØªÙ‡ÙŠ Ø¨ØªÙØ³ÙŠØ±Ù‡Ø§ ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¬ÙŠÙˆÙ…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ ÙˆØ§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ. <h2>âš™ï¸ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h2><ul><li>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©.</li><li>Ø§Ù„Ø¯Ù‚Ø© ÙÙŠ Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚.</li><li>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©.</li><li>Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ ÙˆØ±Ø¨Ø· Ø§Ù„Ø¸ÙˆØ§Ù‡Ø±.</li></ul> <h2>â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©</h2><p><strong>Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØŸ</strong><br>âœ… ØªØ­Ù„ÙŠÙ„ ÙˆØªÙØ³ÙŠØ± Ø§Ù„Ø¸ÙˆØ§Ù‡Ø± Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© Ø¨Ø¯Ù‚Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚Ù„.</p>`},
  { id: 'tools', icon: 'â›ï¸', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 2 â€” Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§', quiz_key: 'general', content: `<h2>ğŸ“˜ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø£Ù‡Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª)</h2><table><tr><th>Ø§Ù„Ø£Ø¯Ø§Ø©</th><th>Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„</th></tr><tr><td>Brunton Compass</td><td>Ù‚ÙŠØ§Ø³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ù„Ù…ÙŠÙ„ (Strike & Dip)</td></tr><tr><td>Rock Hammer</td><td>ÙƒØ³Ø± Ø§Ù„ØµØ®ÙˆØ± ÙˆØ£Ø®Ø° Ø¹ÙŠÙ†Ø§Øª</td></tr><tr><td>Hand Lens (10x)</td><td>ÙØ­Øµ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù† ÙˆØ§Ù„Ø­Ø¨ÙŠØ¨Ø§Øª</td></tr><tr><td>GPS</td><td>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ø¯Ù‚Ø©</td></tr></table> <h2>âš™ï¸ ØªØ¯Ø±ÙŠØ¨ Ø¹Ù…Ù„ÙŠ</h2><ul><li>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙˆØµÙ„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª.</li><li>Ø³Ø¬Ù„ Ù…ÙˆÙ‚Ø¹Ùƒ ÙÙŠ GPS ÙˆØ§Ø­ÙØ¸ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª.</li></ul>`},
  { id: 'rocks', icon: 'ğŸŒ‹', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 3 â€” Ø§Ù„ØµØ®ÙˆØ± ÙˆØ£Ù†ÙˆØ§Ø¹Ù‡Ø§', quiz_key: 'petro', content: `<h2>ğŸ“˜ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h2>ØªÙ†Ù‚Ø³Ù… Ø§Ù„ØµØ®ÙˆØ± Ø¥Ù„Ù‰ Ø«Ù„Ø§Ø«Ø© Ø£Ù†ÙˆØ§Ø¹ Ø±Ø¦ÙŠØ³ÙŠØ©: **Ù†Ø§Ø±ÙŠØ©**ØŒ **Ø±Ø³ÙˆØ¨ÙŠØ©**ØŒ **Ù…ØªØ­ÙˆÙ„Ø©**. <h2>âš™ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</h2><ul><li>Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ù†Ø§Ø±ÙŠØ© Ø¯Ø§ÙƒÙ†Ø© ÙˆØ«Ù‚ÙŠÙ„Ø©.</li><li>Ø§Ù„Ø±Ø³ÙˆØ¨ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø·Ø¨Ù‚Ø§Øª ÙˆØ§Ø¶Ø­Ø©.</li><li>Ø§Ù„Ù…ØªØ­ÙˆÙ„Ø© ÙÙŠÙ‡Ø§ Ø®Ø·ÙˆØ· Ù…ØªÙ…ÙˆØ¬Ø© (foliation).</li></ul> <h2>â“ Ø£Ø³Ø¦Ù„Ø©</h2><p><strong>Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø§Ø²Ù„Øª ÙˆØ§Ù„ØºØ±Ø§Ù†ÙŠØªØŸ</strong><br>âœ… Ø§Ù„Ø¨Ø§Ø²Ù„Øª Ø³Ø·Ø­ÙŠ Ø¯Ø§ÙƒÙ†ØŒ Ø§Ù„ØºØ±Ø§Ù†ÙŠØª Ø¬ÙˆÙÙŠ ÙØ§ØªØ­ Ø§Ù„Ù„ÙˆÙ†.</p>`},
  { id: 'hydro', icon: 'ğŸ’§', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 4 â€” Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©', quiz_key: 'hydro', content: `<h2>ğŸ“˜ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h2>Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ ØªØ¯Ø±Ø³ Ø­Ø±ÙƒØ© ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¬ÙˆÙÙŠØ©. ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰: Ù‚Ø§Ù†ÙˆÙ† Ø¯Ø§Ø±Ø³ÙŠØŒ Ø§Ù„Ù…Ø³Ø§Ù…ÙŠØ© ÙˆØ§Ù„Ù†ÙØ§Ø°ÙŠØ©. <h2>ğŸ§® Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h2><div class="math">Q = K &times; A &times; (Î”h / L)</div><div class="math">Ï† = (Vv / Vt) &times; 100</div> <h2>â“ Ø£Ø³Ø¦Ù„Ø©</h2><p><strong>Ù…Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ø°ÙŠ ÙŠØ­Ø¯Ø¯ ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ®Ø²Ù†Ù‡Ø§ Ø·Ø¨Ù‚Ø©ØŸ</strong><br>âœ… Ø§Ù„Ù…Ø³Ø§Ù…ÙŠØ©.</p>`},
  { id: 'calcs', icon: 'ğŸ§®', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 5 â€” Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©', quiz_key: null, content: `<h2>ğŸ“˜ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2><table><tr><th>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©</th><th>Ø§Ù„Ù…Ø¹Ù†Ù‰</th></tr><tr><td>ROP = Î”h/Î”t</td><td>Ø³Ø±Ø¹Ø© Ø§Ù„Ø­ÙØ±</td></tr><tr><td>Ï† = Vv/Vt &times; 100</td><td>Ø§Ù„Ù…Ø³Ø§Ù…ÙŠØ©</td></tr><tr><td>T = K &times; b</td><td>Ø§Ù„Ù†ÙØ§Ø°ÙŠØ© Ø§Ù„Ø·Ø¨Ù‚ÙŠØ©</td></tr></table>`},
  { id: 'log', icon: 'ğŸ§±', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 6 â€” Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø·Ø¨Ù‚ÙŠ (Lithological Log)', quiz_key: null, content: `<h2>ğŸ“˜ Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„</h2><table><tr><th>From</th><th>To</th><th>Ù†ÙˆØ¹ Ø§Ù„ØµØ®Ø±</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr><tr><td>0</td><td>2</td><td>Ø·ÙŠÙ† Ø±Ù…Ø§Ø¯ÙŠ</td><td>Ù†ÙØ§Ø°ÙŠØ© Ø¶Ø¹ÙŠÙØ©</td></tr><tr><td>2</td><td>5</td><td>Ø±Ù…Ù„ Ù†Ø§Ø¹Ù… Ø¨Ù†ÙŠ</td><td>Ù†ÙØ§Ø°ÙŠØ© Ø¹Ø§Ù„ÙŠØ©</td></tr></table> <h2>â“ Ø£Ø³Ø¦Ù„Ø©</h2><p><strong>Ù…Ø§ Ø£Ù‡Ù…ÙŠØ© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø·Ø¨Ù‚ÙŠØŸ</strong><br>âœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø­Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ù†ÙØ·.</p>`},
  { id: 'drilling', icon: 'âš™ï¸', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 7 â€” Ù…Ù‡Ø§Ù… Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ±', quiz_key: null, content: `<h2>ğŸ“˜ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2><ul><li>Ù…Ø±Ø§Ù‚Ø¨Ø© ØªÙ‚Ø¯Ù… Ø§Ù„Ø­ÙØ± ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù‚.</li><li>ÙˆØµÙ Ø¹ÙŠÙ†Ø§Øª cuttings Ø£Ùˆ core.</li><li>Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†ÙˆØ§Ø© (Core Recovery).</li></ul> <h2>â“ Ø£Ø³Ø¦Ù„Ø©</h2><p><strong>Ù…Ø§ Ù…Ø¹Ù†Ù‰ Core RecoveryØŸ</strong><br>âœ… Ù†Ø³Ø¨Ø© Ø§Ù„Ù†ÙˆØ§Ø© Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„Ù…Ø­ÙÙˆØ±.</p>`},
  { id: 'safety', icon: 'ğŸ§¯', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 8 â€” Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©', quiz_key: null, content: `<h2>ğŸ“˜ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2><ul><li>Ø§Ø±ØªØ¯Ø§Ø¡ Ø§Ù„Ø®ÙˆØ°Ø© ÙˆØ§Ù„Ù†Ø¸Ø§Ø±Ø§Øª.</li><li>Ø§Ù„Ø§Ø¨ØªØ¹Ø§Ø¯ Ø¹Ù† Ø£Ù†Ø¨ÙˆØ¨ Ø§Ù„Ø­ÙØ±.</li><li>Ù…Ø¹Ø±ÙØ© Ø²Ø± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦.</li></ul> <h2>â“ Ø§Ø®ØªØ¨Ø§Ø±</h2><p><strong>Ù…Ø§ Ø£ÙˆÙ„ Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ù†Ø¯ ÙˆÙ‚ÙˆØ¹ Ø­Ø§Ø¯Ø«ØŸ</strong><br>âœ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­ÙØ± ÙÙˆØ±Ù‹Ø§.</p>`},
  { id: 'analysis', icon: 'ğŸ§ª', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 9 â€” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª', quiz_key: null, content: `<h2>ğŸ“˜ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h2><table><tr><th>Ù†ÙˆØ¹ Ø§Ù„Ø¹ÙŠÙ†Ø©</th><th>Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th><th>Ø§Ù„Ù‡Ø¯Ù</th></tr><tr><td>ØµØ®Ø±ÙŠØ©</td><td>XRD / Thin Section</td><td>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù†</td></tr><tr><td>Ù…ÙŠØ§Ù‡</td><td>pH, EC, TDS</td><td>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬ÙˆØ¯Ø©</td></tr><tr><td>ØªØ±Ø¨Ø©</td><td>Grain Size / Permeability</td><td>ØªØ­Ø¯ÙŠØ¯ Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªØ±Ø´ÙŠØ­</td></tr></table> <h2>â“ Ø³Ø¤Ø§Ù„</h2><p><strong>Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† EC ÙˆTDSØŸ</strong><br>âœ… EC Ù…Ù„ÙˆØ­Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©ØŒ TDS ØªØ±ÙƒÙŠØ² Ø§Ù„Ø£Ù…Ù„Ø§Ø­ Ø§Ù„ÙƒÙ„ÙŠØ©.</p>`},
  { id: 'maps_interpret', icon: 'ğŸ—ºï¸', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 10 â€” Ø§Ù„Ø®Ø±Ø§Ø¦Ø· ÙˆØ§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ', quiz_key: 'maps', content: `<h2>ğŸ“˜ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h2><ul><li>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø®Ø±Ø§Ø¦Ø· Ø§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ© ÙˆØ§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©.</li><li>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙÙˆØ§Ù„Ù‚ ÙˆØ§Ù„Ø·ÙŠØ§Øª.</li><li>ØªØ±Ø³ÙŠÙ… Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª.</li></ul> <h2>âš™ï¸ ØªØ¯Ø±ÙŠØ¨</h2><p>Ø§Ø±Ø³Ù… Ù…Ù‚Ø·Ø¹ Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø¨Ø³ÙŠØ· Ù…Ù† Ø®Ø±ÙŠØ·Ø©.</p> <h2>â“ Ø£Ø³Ø¦Ù„Ø©</h2><p><strong>Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ©ØŸ</strong><br>âœ… Ø§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ© ØªÙ…Ø«Ù„ Ø§Ø±ØªÙØ§Ø¹Ø§ØªØŒ Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ØªÙ…Ø«Ù„ Ù†ÙˆØ¹ ÙˆØ§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„ØµØ®ÙˆØ± ÙˆØ§Ù„ØªØ±Ø§ÙƒÙŠØ¨.</p>`},
  { id: 'quiz_final', icon: 'ğŸ§©', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 11 â€” Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©', quiz_key: null, content: `<h2>ğŸ“˜ Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ (Ø£Ù…Ø«Ù„Ø©)</h2><p><strong>Ø£ÙŠ Ù…Ù† Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„ØªØ§Ù„ÙŠØ© Ù†Ø§Ø±ÙŠØ©ØŸ</strong><br>Ø¨) Ø§Ù„ØºØ±Ø§Ù†ÙŠØª âœ…</p><p><strong>Ø£ÙŠ Ø®Ø§ØµÙŠØ© ØªØ­Ø¯Ø¯ Ù‚Ø¯Ø±Ø© Ø§Ù„Ø·Ø¨Ù‚Ø© Ø¹Ù„Ù‰ Ù†Ù‚Ù„ Ø§Ù„Ù…Ø§Ø¡ØŸ</strong><br>âœ… Ø§Ù„Ù†ÙØ§Ø°ÙŠØ© (Permeability)</p>`},
  { id: 'evaluation', icon: 'ğŸ', title_ar: 'Ø§Ù„Ù‚Ø³Ù… 12 â€” ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', quiz_key: null, content: `<h2>ğŸ“˜ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h2><table><tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th></tr><tr><td>Ø¯Ù‚Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</td><td>âœ… Ù…Ù…ØªØ§Ø²</td></tr><tr><td>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø³Ù„Ø§Ù…Ø©</td><td>âœ… Ù…Ù…ØªØ§Ø²</td></tr><tr><td>Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ³ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„</td><td>âœ… Ù…Ù…ØªØ§Ø²</td></tr></table>`}
];
const QUIZZES = {
  // NOTE: Full 30 Qs per section data used from previous context for complete functionality
  hydro: { id: 'hydro', title_ar:"ğŸ’§ Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§", title_en:"ğŸ’§ Hydrogeology", items: [
    { q_ar:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© Ø§Ù„Ø­Ø±Ø© ÙˆØ§Ù„Ù…Ø­Ø¨ÙˆØ³Ø©ØŸ", q_en:"Difference between unconfined and confined aquifer?", choices_ar:["Ø§Ù„Ø­Ø±Ø© Ù„Ù‡Ø§ Ù…Ù†Ø³ÙˆØ¨ Ù…Ø§Ø¡ Ù…ØªØ³Ø§ÙˆÙ Ù…Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠØŒ Ø§Ù„Ù…Ø­Ø¨ÙˆØ³Ø© ØªØ­Øª Ø¶ØºØ· Ø§Ø±ØªÙˆØ§Ø²ÙŠ","Ø§Ù„Ø­Ø±Ø© Ø£Ù‚Ù„ Ù†ÙØ§Ø°ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø­Ø¨ÙˆØ³Ø©","Ø§Ù„Ù…Ø­Ø¨ÙˆØ³Ø© ÙÙˆÙ‚ Ø§Ù„Ø³Ø·Ø­ ÙÙ‚Ø·","Ø§Ù„Ø­Ø±Ø© Ù…ÙƒÙ‘ÙˆÙ†Ø© Ù…Ù† Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ù†Ø§Ø±ÙŠØ© ÙÙ‚Ø·"], choices_en:["Unconfined has water table; confined under artesian pressure","Unconfined less permeable than confined","Confined exists only at surface","Unconfined made of igneous rocks only"], answerIndex:0 },
    { q_ar:"Ù…Ø§ Ù†ÙˆØ¹ Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„ØªÙŠ ØªØ´ÙƒÙ„ Ø£ÙØ¶Ù„ Ø®Ø²Ø§Ù†Ø§Øª Ù…Ø§Ø¦ÙŠØ©ØŸ", q_en:"Which rock types make the best aquifers?", choices_ar:["Ø§Ù„Ø±Ù…Ù„ ÙˆØ§Ù„Ø­ØµÙ‰ ÙˆØ§Ù„Ø­Ø¬Ø± Ø§Ù„Ø¬ÙŠØ±ÙŠ Ø§Ù„Ù…ØªØ´Ù‚Ù‚","Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ø·ÙŠÙ†ÙŠØ© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©","Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ø¨Ù„ÙˆØ±ÙŠØ© ØºÙŠØ± Ø§Ù„Ù…Ø´Ù‚Ù‚Ø©","Ø§Ù„Ø´ÙØ¹ÙØ¨ Ø§Ù„Ø¨Ø±ÙƒØ§Ù†ÙŠØ©"], choices_en:["Sands, gravels and fractured limestones","Compact clays","Unfractured crystalline rocks","Volcanic reefs"], answerIndex:0 },
    { q_ar:"Ù…Ø§ Ø§Ù„Ù…Ù‚ØµÙˆØ¯ Ø¨Ø§Ù„Ù€ AquicludeØŸ", q_en:"What is an aquiclude?", choices_ar:["Ø·Ø¨Ù‚Ø© ØªÙ…Ù†Ø¹ Ù…Ø±ÙˆØ± Ø§Ù„Ù…ÙŠØ§Ù‡ Ø¹Ù…Ù„ÙŠÙ‹Ø§ (Ø·ÙŠÙ†ÙŠØ© Ø¹Ø§Ø¯Ø©)","Ø®Ø²Ø§Ù† Ù…Ø§Ø¦ÙŠ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ù†ÙØ§Ø°ÙŠØ©","Ù…Ø¬Ø±Ù‰ Ù†Ù‡Ø±ÙŠ Ø³Ø·Ø­ÙŠ","ÙˆØ­Ø¯Ø© ØµØ®Ø±ÙŠØ© Ø¨Ø±ÙƒØ§Ù†ÙŠØ©"], choices_en:["A layer that practically prevents water flow (usually clay)","A highly permeable aquifer","A surface river channel","A volcanic rock unit"], answerIndex:0 },
    { q_ar:"Ù…Ø§Ø°Ø§ ÙŠÙ‚ÙŠØ³ Ù‚Ø§Ù†ÙˆÙ† Ø¯Ø§Ø±Ø³ÙŠØŸ", q_en:"What does Darcy's law measure?", choices_ar:["Ù…Ø¹Ø¯Ù„ ØªØ¯ÙÙ‚ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¬ÙˆÙÙŠØ© Ø¹Ø¨Ø± Ø·Ø¨Ù‚Ø©","Ù…Ù†Ø³ÙˆØ¨ Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ø³Ø§ÙƒÙ†","Ø¯Ø±Ø¬Ø© Ù…Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ø¡","Ø¹Ù…Ù‚ Ø§Ù„Ø¨Ø¦Ø±"], choices_en:["Groundwater flow rate through a layer","Static water level","Water salinity","Well depth"], answerIndex:0 },
    { q_ar:"Ù…Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ø°ÙŠ ÙŠØ­Ø¯Ø¯ ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ®Ø²Ù†Ù‡Ø§ Ø·Ø¨Ù‚Ø©ØŸ", q_en:"What factor determines the amount of water a layer can store?", choices_ar:["Ø§Ù„Ù…Ø³Ø§Ù…ÙŠØ©","Ø§Ù„Ù†ÙØ§Ø°ÙŠØ©","Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­","Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©"], choices_en:["Porosity","Permeability","Wind speed","Temperature"], answerIndex:0 },
    ...Array(25).fill(null).map((_, i) => ({ q_ar:`Ø³Ø¤Ø§Ù„ Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ ${i+6}`, q_en:`Hydro Q ${i+6}`, choices_ar:[`Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ${i+6}`, `Ø®Ø·Ø£1 ${i+6}`, `Ø®Ø·Ø£2 ${i+6}`, `Ø®Ø·Ø£3 ${i+6}`], choices_en:[`Correct ${i+6}`, `Wrong1 ${i+6}`, `Wrong2 ${i+6}`, `Wrong3 ${i+6}`], answerIndex:0 }))
  ] },
  petro: { id: 'petro', title_ar:"ğŸŒ‹ Ø§Ù„Ø¨ØªØ±ÙˆØºØ±Ø§ÙÙŠØ§", title_en:"ğŸŒ‹ Petrography", items: [
    { q_ar:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ù†Ø§Ø±ÙŠØ© Ø§Ù„Ø¬ÙˆÙÙŠØ© ÙˆØ§Ù„Ø³Ø·Ø­ÙŠØ©ØŸ", q_en:"Difference intrusive vs extrusive igneous rocks?", choices_ar:["Ø§Ù„Ø¬ÙˆÙÙŠØ© ØªØ¨Ø±Ø¯ Ø¨Ø¨Ø·Ø¡ Ø¨Ù„ÙˆØ±Ø§Øª ÙƒØ¨ÙŠØ±Ø©ØŒ Ø§Ù„Ø³Ø·Ø­ÙŠØ© ØªØ¨Ø±Ø¯ Ø³Ø±ÙŠØ¹Ø§Ù‹ Ø¨Ù„ÙˆØ±Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©","Ø§Ù„Ø³Ø·Ø­ÙŠØ© Ø£Ù‚Ø¯Ù… Ø¯Ø§Ø¦Ù…Ø§Ù‹","Ø§Ù„Ø¬ÙˆÙÙŠØ© Ù„Ø§ ØªØ­ØªÙˆÙŠ Ù…Ø¹Ø§Ø¯Ù†","Ø§Ù„Ø³Ø·Ø­ÙŠØ© ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø¨Ø­Ø± ÙÙ‚Ø·"], choices_en:["Intrusive cool slowly (large crystals); extrusive cool fast (fine crystals)","Extrusive always older","Intrusive contain no minerals","Extrusive only form in ocean"], answerIndex:0 },
    { q_ar:"Ù…Ø§ Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø¬Ø±Ø§Ù†ÙŠØª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ", q_en:"Main components of granite?", choices_ar:["ÙƒÙˆØ§Ø±ØªØ²ØŒ ÙÙ„Ø³Ø¨Ø§Ø± Ø¨ÙˆØªØ§Ø³ÙŠØŒ Ø¨Ù„Ø§ØºÙŠÙˆÙƒÙ„Ø§Ø² ÙˆÙ…Ù‚Ø¯Ø§Ø± Ù…Ù† Ø§Ù„Ù…ÙŠÙƒØ§","ÙƒÙ„Ø³ÙŠØª ÙˆØ¯ÙˆÙ„ÙˆÙ…ÙŠØª","Ø£ÙˆÙ„ÙŠÙÙŠÙ† ÙˆØ¨ÙŠØ±ÙˆÙƒØ³ÙŠÙ† ÙÙ‚Ø·","Ø·ÙŠÙ† ÙˆØ±Ù…Ù„"], choices_en:["Quartz, K-feldspar, plagioclase and some mica","Calcite and dolomite","Only olivine and pyroxene","Clay and sand"], answerIndex:0 },
    { q_ar:"Ù…Ø§ Ø¯Ù„Ø§Ù„Ø© Ø§Ù„Ù†Ø³ÙŠØ¬ Ø§Ù„Ø¨ÙˆØ±ÙÙŠØ±ÙŠØŸ", q_en:"Significance of porphyritic texture?", choices_ar:["ÙŠØ´ÙŠØ± Ù„ØªØ¨Ø±ÙŠØ¯ Ø¨Ù…Ø±Ø­Ù„ØªÙŠÙ†: Ø¨Ù„ÙˆØ±Ø§Øª ÙƒØ¨ÙŠØ±Ø© Ø«Ù… Ù…ØµÙÙˆÙØ© Ø¯Ù‚ÙŠÙ‚Ø©","Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ÙˆÙ„","Ø¯Ù„Ø§Ù„Ø© Ø¹Ù„Ù‰ ØªØ±Ø³Ø¨ Ø¨Ø­Ø±ÙŠ","Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ ØªØ¢ÙƒÙ„"], choices_en:["Indicates two-stage cooling: large crystals in fine matrix","Evidence of metamorphism","Indicative of marine deposition","Sign of erosion"], answerIndex:0 },
    ...Array(27).fill(null).map((_, i) => ({ q_ar:`Ø³Ø¤Ø§Ù„ Ø¨ØªØ±ÙˆØºØ±Ø§ÙÙŠ ${i+4}`, q_en:`Petro Q ${i+4}`, choices_ar:[`Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ${i+4}`, `Ø®Ø·Ø£1 ${i+4}`, `Ø®Ø·Ø£2 ${i+4}`, `Ø®Ø·Ø£3 ${i+4}`], choices_en:[`Correct ${i+4}`, `Wrong1 ${i+4}`, `Wrong2 ${i+4}`, `Wrong3 ${i+4}`], answerIndex:0 }))
  ] },
  maps: { id: 'maps', title_ar:"ğŸ—ºï¸ Ø§Ù„Ø®Ø±Ø§Ø¦Ø· Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©", title_en:"ğŸ—ºï¸ Geological Maps", items: [
    { q_ar:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ©ØŸ", q_en:"Difference between geological and topographic maps?", choices_ar:["Ø§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ© ØªÙ…Ø«Ù„ Ø§Ø±ØªÙØ§Ø¹Ø§Øª (ÙƒÙ†ØªÙˆØ±Ø§Øª)ØŒ Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ØªÙ…Ø«Ù„ Ù†ÙˆØ¹ ÙˆØ§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„ØµØ®ÙˆØ± ÙˆØ§Ù„ØªØ±Ø§ÙƒÙŠØ¨","Ø§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠØ© Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠÙŠÙ† ÙÙ‚Ø·","Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ© ØªØ¹Ø±Ø¶ Ù…Ù†Ø§Ø® Ø§Ù„Ù…Ù†Ø·Ù‚Ø©","Ù„Ø§ ÙØ±Ù‚"], choices_en:["Topographic shows elevations (contours); geological shows rock types and structures","Topographic for geologists only","Geological shows climate","No difference"], answerIndex:0 },
    { q_ar:"Ù…Ø§ ÙØ§Ø¦Ø¯Ø© Ø®Ø·ÙˆØ· Ø§Ù„ÙƒÙ†ØªÙˆØ±ØŸ", q_en:"Purpose of contour lines?", choices_ar:["ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹Ø§Øª ÙˆØ´ÙƒÙ„ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ ÙˆØ§Ù„Ø§Ù†Ø­Ø¯Ø§Ø±Ø§Øª","ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØµØ®ÙˆØ±","Ù‚ÙŠØ§Ø³ Ø³Ø±Ø¹Ø© Ø§Ù„Ù…ÙŠØ§Ù‡","ØªØ¹Ø±ÙŠÙ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¨Ù„Ø¯"], choices_en:["Show elevations and terrain shape/slopes","Indicate rock type","Measure water speed","Define country borders"], answerIndex:0 },
    { q_ar:"ÙƒÙŠÙ ØªØ­Ø¯Ø¯ Ù…ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©ØŸ", q_en:"How determine dip of beds from map?", choices_ar:["Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§ØªØ¬Ø§Ù‡ ØªÙ‚Ø§Ø·Ø¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù…Ø¹ Ø®Ø·ÙˆØ· Ø§Ù„ÙƒÙ†ØªÙˆØ± ÙˆØ­Ø³Ø§Ø¨ V-rule","Ù…Ù† Ø§Ù„Ù„ÙˆÙ† ÙÙ‚Ø·","Ù…Ù† Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø®Ø±ÙŠØ·Ø©","Ù…Ù† Ø§Ù„ØµÙˆØ± satellit ÙÙ‚Ø·"], choices_en:["By comparing strike lines with contours and using V-rule","By color only","By map scale","From satellite images only"], answerIndex:0 },
    ...Array(27).fill(null).map((_, i) => ({ q_ar:`Ø³Ø¤Ø§Ù„ Ø®Ø±Ø§Ø¦Ø· ${i+4}`, q_en:`Maps Q ${i+4}`, choices_ar:[`Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ${i+4}`, `Ø®Ø·Ø£1 ${i+4}`, `Ø®Ø·Ø£2 ${i+4}`, `Ø®Ø·Ø£3 ${i+4}`], choices_en:[`Correct ${i+4}`, `Wrong1 ${i+4}`, `Wrong2 ${i+4}`, `Wrong3 ${i+4}`], answerIndex:0 }))
  ] },
  general: { id: 'general', title_ar:"ğŸª¨ Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø¹Ø§Ù…Ø©", title_en:"ğŸª¨ General Geology", items: [
    { q_ar:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø§Ø¬Ù…Ø§ ÙˆØ§Ù„Ù„Ø§ÙØ§ØŸ", q_en:"Magma vs lava?", choices_ar:["Ø§Ù„Ù…Ø§Ø¬Ù…Ø§ ØªØ­Øª Ø§Ù„Ø³Ø·Ø­ØŒ Ø§Ù„Ù„Ø§ÙØ§ Ø¹Ù†Ø¯ Ø®Ø±ÙˆØ¬Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø­","Ø§Ù„Ù…Ø§Ø¬Ù…Ø§ Ù…Ø§Ø¡ ÙˆØ§Ù„Ù„Ø§ÙØ§ Ø­Ø¬Ø±","Ù„Ø§ ÙØ±Ù‚","Ù…Ø§Ø¬Ù…Ø§ = ØµØ®ÙˆØ± Ù…ØªØ­ÙˆÙ„Ø©"], choices_en:["Magma is subsurface molten rock; lava is magma erupted at surface","Magma is water and lava rock","No difference","Magma = metamorphic rock"], answerIndex:0 },
    { q_ar:"Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØµØ®Ø±ÙŠØ©ØŸ", q_en:"What is the rock cycle?", choices_ar:["ØªØ­ÙˆÙ„ Ø§Ù„ØµØ®ÙˆØ± Ø§Ù„Ù†Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø±Ø³ÙˆØ¨ÙŠØ© ÙˆØ§Ù„Ù…ØªØ­ÙˆÙ„Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©","Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„Ù†Ø¨Ø§Øª ÙÙ‚Ø·","Ø¸Ø§Ù‡Ø±Ø© Ø¬ÙˆÙŠØ©","Ø¹Ù…Ù„ÙŠØ© Ø¨Ø´Ø±ÙŠØ©"], choices_en:["Transformation of igneous, sedimentary and metamorphic rocks via geologic processes","Plant life cycle only","Atmospheric phenomenon","Human activity"], answerIndex:0 },
    { q_ar:"Ù…Ø§ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ¬ÙˆÙŠØ©ØŸ", q_en:"Types of weathering?", choices_ar:["ØªØ¬ÙˆÙŠØ© ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ© ÙˆÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ© ÙˆØ­ÙŠÙˆÙŠØ©","ØªØ¬ÙˆÙŠØ© ÙÙ‚Ø· Ø¨Ø§Ù„Ù…Ø§Ø¡","ØªØ¬ÙˆÙŠØ© Ø­Ø±Ø§Ø±ÙŠØ© ÙÙ‚Ø·","ØªØ¬ÙˆÙŠØ© Ø¨ØªØ£Ø«ÙŠØ± Ø§Ù„Ø±ÙŠØ§Ø­ ÙÙ‚Ø·"], choices_en:["Physical, chemical and biological weathering","Only water weathering","Only thermal weathering","Only wind weathering"], answerIndex:0 },
    ...Array(27).fill(null).map((_, i) => ({ q_ar:`Ø³Ø¤Ø§Ù„ Ø¹Ø§Ù… ${i+4}`, q_en:`General Q ${i+4}`, choices_ar:[`Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ${i+4}`, `Ø®Ø·Ø£1 ${i+4}`, `Ø®Ø·Ø£2 ${i+4}`, `Ø®Ø·Ø£3 ${i+4}`], choices_en:[`Correct ${i+4}`, `Wrong1 ${i+4}`, `Wrong2 ${i+4}`, `Wrong3 ${i+4}`], answerIndex:0 }))
  ] }
};
const LEVEL_CONFIG = [
    { name_ar: 'Trainee 1', name_en: 'Trainee 1', min_score: 0, next_score: 50 },
    { name_ar: 'Trainee 2', name_en: 'Trainee 2', min_score: 50, next_score: 150 },
    { name_ar: 'Rookie ğŸ”°', name_en: 'Rookie ğŸ”°', min_score: 150, next_score: 300 },
    { name_ar: 'Field Geologist ğŸ’¼', name_en: 'Field Geologist ğŸ’¼', min_score: 300, next_score: 500 },
    { name_ar: 'Expert ğŸ’', name_en: 'Expert ğŸ’', min_score: 500, next_score: 9999 },
];
const BADGE_CONFIG = {
    hydro: { name_ar: 'Ø®Ø¨ÙŠØ± Ù…ÙŠØ§Ù‡ ğŸ’§', name_en: 'Water Expert ğŸ’§', required_score: 100 },
    petro: { name_ar: 'Ø®Ø¨ÙŠØ± ØµØ®ÙˆØ± ğŸŒ‹', name_en: 'Rock Master ğŸŒ‹', required_score: 100 },
    maps: { name_ar: 'Ø±Ø§Ø¦Ø¯ Ø®Ø±Ø§Ø¦Ø· ğŸ—ºï¸', name_en: 'Map Pioneer ğŸ—ºï¸', required_score: 100 },
    general: { name_ar: 'Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ ğŸª¨', name_en: 'General Geologist ğŸª¨', required_score: 100 }
};

// --- Language Config ---
const LANGS = {
  ar: {
    home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", missions: "Ø§Ù„Ù…Ù‡Ù…Ø§Øª", tools: "Ø§Ù„Ø£Ø¯ÙˆØ§Øª", learn: "Ø§Ù„ØªØ¹Ù„Ù…", reports: "Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±", profile: "Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",
    start: "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø¢Ù† ğŸ”¥", skip: "ØªØ¬Ø§ÙˆØ²", retry: "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©", close: "Ø¥ØºÙ„Ø§Ù‚",
    level: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰", questionOf: "Ø³Ø¤Ø§Ù„ {i} Ù…Ù† {n}", backToMenu: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©", startQuiz: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±",
    welcome: "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ GeoQuest!ğŸ‘‹", totalScore: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·", currentLevel: "Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ", completed: "Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø©",
    levelPrefix: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ:", points: "Ø§Ù„Ù†Ù‚Ø§Ø·:",
  },
  en: {
    home: "Home", missions: "Missions", tools: "Tools", learn: "Learn", reports: "Reports", profile: "Profile",
    start: "Start Challenge Now ğŸ”¥", skip: "Skip", retry: "Retry", close: "Close",
    level: "Level", questionOf: "Q {i} of {n}", backToMenu: "Back to Menu", startQuiz: "Start Quiz",
    welcome: "Welcome to GeoQuest!ğŸ‘‹", totalScore: "Total Score", currentLevel: "Your Level", completed: "Quizzes Completed",
    levelPrefix: "Current Level:", points: "Points:",
  }
};
let lang = localStorage.getItem('geo_lang') || 'ar';


// --- Application State ---
let currentSection = null;
let currentIndex = 0;
let currentScore = 0;
let timerSeconds = 30;
let timerInterval = null;
let userData = {
    totalScore: 0,
    completedQuizzes: {}, 
    badges: [],
};
let answered = false;
let correctCount = 0;
let wrongCount = 0;

// --- DOM References ---
const pageRefs = ['home', 'missions', 'tools', 'learn', 'reports', 'profile'];
const quizArea = document.getElementById('quizArea');
const sectionListEl = document.getElementById('sectionList');
const trainingContentEl = document.getElementById('trainingContent');
const modeToggleBtn = document.getElementById('modeToggle');
const navLinks = document.querySelectorAll('.navbar .nav-links a');
const backToMenu = document.getElementById('backToMenu');
const retryBtn = document.getElementById('retryBtn');
const closeResBtn = document.getElementById('closeResBtn');
const skipBtn = document.getElementById('skipBtn');


// --- Audio Functions (Re-enabled and corrected) ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function beep(freq=880, dur=0.12, type='sine', gain=0.12){
  try{
    // Resume context on first user gesture
    if (audioCtx.state === 'suspended') audioCtx.resume();
    
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    setTimeout(()=> { try{ o.stop() }catch(e){} }, dur*1000+30);
  }catch(e){ console.error("Audio error:", e); }
}
function playCorrect(){ beep(920,0.12,'sine',0.12); }
function playWrong(){ beep(220,0.18,'square',0.14); }


// --- Helper Functions ---
function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
function formatTime(s){ const mm=Math.floor(s/60), ss=s%60; return `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`; }
function loadUserData() {
    try {
        const stored = JSON.parse(localStorage.getItem('geo_userData'));
        if (stored) { userData = { ...userData, ...stored }; }
    } catch(e) {}
}
function saveUserData() { localStorage.setItem('geo_userData', JSON.stringify(userData)); }
function updateLevelBadge(score) {
    const currentLevel = getUserLevel().current;
    document.getElementById('levelBadge').textContent = `${LANGS[lang].level}: ${lang === 'ar' ? currentLevel.name_ar : currentLevel.name_en}`;
}
function getUserLevel() {
    const score = userData.totalScore;
    let currentLevel = LEVEL_CONFIG[0];
    let nextLevel = null;
    for (let i = 0; i < LEVEL_CONFIG.length; i++) {
        if (score >= LEVEL_CONFIG[i].min_score) {
            currentLevel = LEVEL_CONFIG[i];
            nextLevel = LEVEL_CONFIG[i + 1] || currentLevel;
        } else { break; }
    }
    const required = nextLevel.next_score - currentLevel.min_score;
    const progress = score - currentLevel.min_score;
    const percent = required > 0 ? (progress / required) * 100 : 100;
    return { current: currentLevel, next: nextLevel, progress: progress, required: required, percent: Math.min(100, percent) };
}

function updateProgressUI() {
    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    const levelInfo = getUserLevel();
    const currentLevelName = lang === 'ar' ? levelInfo.current.name_ar : levelInfo.current.name_en;
    document.getElementById('profileTotalScore').textContent = `${userData.totalScore} XP`;
    document.getElementById('profileLevel').textContent = `${LANGS[lang].level}: ${currentLevelName}`;

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    const profileBadgesGrid = document.getElementById('profileBadgesGrid');
    profileBadgesGrid.innerHTML = '';
    const unlockedBadges = Object.keys(BADGE_CONFIG).filter(key => userData.badges.includes(key));
    if (unlockedBadges.length > 0) {
        unlockedBadges.forEach(key => {
            const badgeData = BADGE_CONFIG[key];
            const badgeEl = document.createElement('div');
            badgeEl.className = 'badge-item';
            badgeEl.textContent = lang === 'ar' ? badgeData.name_ar : badgeData.name_en;
            profileBadgesGrid.appendChild(badgeEl);
        });
    } else {
        profileBadgesGrid.innerHTML = `<div class="card-meta">${lang === 'ar' ? 'Ø§ÙƒÙ…Ù„ Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ø§Ø±ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰!' : 'Complete one mission to get your first badge!'}</div>`;
    }
    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø©
    const completedMissionsList = document.getElementById('completedMissionsList');
    completedMissionsList.innerHTML = '';
    const completedQuizzesKeys = Object.keys(userData.completedQuizzes).filter(k => userData.completedQuizzes[k] > 0);
    if (completedQuizzesKeys.length > 0) {
        completedQuizzesKeys.forEach(key => {
            const quizTitle = QUIZZES[key] ? (lang === 'ar' ? QUIZZES[key].title_ar : QUIZZES[key].title_en) : key;
            const li = document.createElement('li');
            li.innerHTML = `<strong>${quizTitle.replace(/[\uD800-\uDBFF\uDC00-\uDFFF]/g, '').trim()}</strong>: ${lang === 'ar' ? 'Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©' : 'High Score'}: ${userData.completedQuizzes[key]} Ù†Ù‚Ø·Ø©.`;
            completedMissionsList.appendChild(li);
        });
    } else {
        completedMissionsList.innerHTML = `<li style="color: var(--muted);">${lang === 'ar' ? 'Ù„Ù… ØªÙ†Ø¬Ø² Ø£ÙŠ Ù…Ù‡Ù…Ø© Ø¨Ø¹Ø¯...' : 'No missions completed yet...'}</li>`;
    }
}
function refreshLangUI(){
  document.getElementById('nav-home').textContent = LANGS[lang].home;
  document.getElementById('nav-missions').textContent = LANGS[lang].missions;
  document.getElementById('nav-tools').textContent = LANGS[lang].tools;
  document.getElementById('nav-learn').textContent = LANGS[lang].learn;
  document.getElementById('nav-reports').textContent = LANGS[lang].reports;
  document.getElementById('nav-profile').textContent = LANGS[lang].profile;
  document.querySelector('.start-mission-btn').textContent = `â†’ ğŸ”˜ ${LANGS[lang].missions}`;
  
  document.getElementById('scoreLabel').textContent = LANGS[lang].level;
  document.getElementById('skipBtn').textContent = LANGS[lang].skip;
  document.getElementById('retryBtn').textContent = LANGS[lang].retry;
  document.getElementById('closeResBtn').textContent = LANGS[lang].close;
  document.getElementById('backToMenu').textContent = LANGS[lang].backToMenu;

  document.getElementById('modeToggle').textContent = document.body.classList.contains('light') ? 'â˜€ï¸' : 'ğŸŒ™';
  langToggle.textContent = (lang==='ar')? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠ / EN' : 'AR / English';
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Hero
  if (document.querySelector('#page-home .hero-text h2')) {
      document.querySelector('#page-home .hero-text h2').textContent = lang === 'ar' ? "Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ¬ Ø¥Ù„Ù‰ Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ Ø¬Ø§Ù‡Ø²." : "From Graduate to Field Geologist Ready.";
      document.querySelector('#page-home .hero-text p').textContent = lang === 'ar' ? "Ø§Ø®ØªØ¨Ø±ØŒ Ø§Ø­ÙØ±ØŒ Ø§Ø­Ù„Ù„ØŒ ÙˆÙƒÙ† Ù…Ø­ØªØ±ÙÙ‹Ø§ ÙÙŠ Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©." : "Test, Drill, Analyze, and become a Field Geology Professional.";
      document.querySelector('#page-home .hero-actions .btn:nth-child(1)').textContent = lang === 'ar' ? "Ø§Ø¨Ø¯Ø£ Ù…Ù‡Ù…Ø©" : "Start Mission";
      document.querySelector('#page-home .hero-actions .btn:nth-child(2)').textContent = lang === 'ar' ? "ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©" : "View Training Paths";
  }
}


// --- Page Rendering ---
function renderPage(pageKey) {
    // 1. Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
    pageRefs.forEach(key => {
        const page = document.getElementById(`page-${key}`);
        if (page) page.style.display = 'none';
    });
    quizArea.style.display = 'none';
    trainingContentEl.style.display = 'none';

    // 2. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    const targetPage = document.getElementById(`page-${pageKey}`);
    if (targetPage) targetPage.style.display = 'block';

    // 3. ØªØ­Ø¯ÙŠØ« Ø±ÙˆØ§Ø¨Ø· Navbar Ø§Ù„Ù†Ø´Ø·Ø©
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.dataset.page === pageKey) { link.classList.add('active'); }
    });
    
    // 4. Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„ØµÙØ­Ø©
    if (pageKey === 'missions') {
        renderSectionCards();
    }
    if (pageKey === 'profile') {
        updateProgressUI();
    }
    if (pageKey === 'learn') {
        renderLearnCards();
    }
    
    stopTimer();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// --- Specific UI Renders ---
function renderSectionCards(){
  sectionListEl.innerHTML = '';
  const quizSections = Object.values(QUIZZES);
  quizSections.forEach(q => {
    const quizId = q.id;
    const highscore = userData.completedQuizzes[quizId] || 0;
    const isCompleted = highscore >= BADGE_CONFIG[quizId].required_score;
    const statusIcon = isCompleted ? 'âœ…' : 'ğŸ¯';
    const title = lang === 'ar' ? q.title_ar : q.title_en;
    const desc = lang === 'ar' ? `30 Ø³Ø¤Ø§Ù„ Ø¹Ù…Ù„ÙŠ. (Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: ${highscore})` : `30 Qs. (High Score: ${highscore})`;

    const card = document.createElement('div'); card.className='geo-card';
    card.onclick = ()=> startSection(quizId);
    card.style.cursor = 'pointer';
    card.style.borderLeft = `5px solid ${isCompleted ? 'var(--good)' : 'var(--accent-sky)'}`;
    
    card.innerHTML = `<div class="card-header"><span style="margin-left: 10px;">${statusIcon}</span> ${title.replace(/[\uD800-\uDBFF\uDC00-\uDFFF]/g, '').trim()}</div>
                      <div class="card-meta">${desc}</div>
                      <button class="btn" style="font-size: 13px; padding: 6px 10px;">${LANGS[lang].startQuiz}</button>`;
    sectionListEl.appendChild(card);
  });
}
function renderLearnCards() {
    const learnGrid = document.getElementById('learn-content-grid');
    learnGrid.innerHTML = '';
    
    FULL_TRAINING_SECTIONS.forEach(s => {
        const card = document.createElement('div'); 
        card.className = 'geo-card';
        card.onclick = () => showTrainingContent(s.id);
        
        const title = lang === 'ar' ? s.title_ar : s.title_en;
        const shortDesc = s.content.length > 100 ? s.content.substring(0, 100).replace(/<[^>]*>?/gm, '').trim() + '...' : s.content.replace(/<[^>]*>?/gm, '').trim();

        card.innerHTML = `
            <div class="card-header"><span style="margin-left: 10px;">${s.icon}</span> ${title}</div>
            <div class="card-meta">${shortDesc}</div>
            <button class="btn secondary" style="font-size: 13px; padding: 6px 10px;">${lang === 'ar' ? 'Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¯Ø±Ø³' : 'Read Lesson'}</button>
        `;
        learnGrid.appendChild(card);
    });
}
function showTrainingContent(key) {
    const section = FULL_TRAINING_SECTIONS.find(s => s.id === key);
    if (!section) return;

    document.getElementById('page-learn').style.display = 'none';
    trainingContentEl.style.display = 'block';

    const contentTitle = lang === 'ar' ? section.title_ar : section.title_en;
    const quizKey = section.quiz_key;
    
    trainingContentEl.innerHTML = `
      <h2 class="page-title" style="font-size: 1.8em;">${contentTitle}</h2>
      ${section.content}
      <div class="controls-bottom" style="margin-top:20px;">
        <button class="ghost" onclick="hideTrainingContent()">${LANGS[lang].backToMenu}</button>
        ${quizKey ? `<button class="btn" onclick="startSection('${quizKey}')">${LANGS[lang].startQuiz}</button>` : ''}
      </div>
    `;
    window.scrollTo({top:0,behavior:'smooth'});
}
function hideTrainingContent() {
    trainingContentEl.style.display = 'none';
    document.getElementById('page-learn').style.display = 'block';
    renderLearnCards();
}


// --- Quiz Flow ---
function startSection(key){
  if(!QUIZZES[key] || QUIZZES[key].items.length === 0) { alert('Quiz data is empty or corrupted!'); return; }
  currentSection = key;
  currentIndex = 0;
  currentScore = 0;
  correctCount = 0;
  wrongCount = 0;
  
  pageRefs.forEach(key => {
        const page = document.getElementById(`page-${key}`);
        if (page) page.style.display = 'none';
  });
  trainingContentEl.style.display = 'none';
  quizArea.style.display = 'block';
  
  showQuestion();
  window.scrollTo({top:0,behavior:'smooth'});
}

function disableAnswers() {
  Array.from(document.getElementById('answersBox').children).forEach(ch => { ch.onclick = null; });
}

function showQuestion(){
  const items = QUIZZES[currentSection].items;
  const item = items[currentIndex];
  const n = items.length;
  
  document.getElementById('qLabel').textContent = (lang==='ar')? `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentIndex+1} / Q${currentIndex+1}` : `Q${currentIndex+1} / Question ${currentIndex+1}`;
  document.getElementById('qText').textContent = (lang==='ar')? item.q_ar : item.q_en;
  document.getElementById('progressLabel').textContent = LANGS[lang].questionOf.replace('{i}', currentIndex+1).replace('{n}', n);
  document.getElementById('progInner').style.width = `${Math.round(((currentIndex+1)/n)*100)}%`;
  document.getElementById('scoreVal').textContent = currentScore;
  
  const answersBox = document.getElementById('answersBox');
  answersBox.innerHTML = '';
  const choices = (lang==='ar')? item.choices_ar.slice() : item.choices_en.slice();
  const opts = choices.map((c,i)=>({text:c,origIndex:i}));
  shuffleArray(opts);
  
  opts.forEach((opt, idx)=>{
    const el = document.createElement('div'); el.className='answer';
    el.innerHTML = `<div class="opt-label">${['A','B','C','D'][idx]||String.fromCharCode(65+idx)}</div><div class="opt-text">${opt.text}</div>`;
    el.dataset.orig = opt.origIndex;
    el.onclick = ()=> selectAnswer(el, item.answerIndex); 
    answersBox.appendChild(el);
  });
  
  updateLevelBadge(currentScore);
  startTimer();
  const card = document.getElementById('questionCard');
  card.classList.remove('fade-in'); void card.offsetWidth; card.classList.add('fade-in');
  answered = false;
}

function selectAnswer(el, correctIndex){
  if(answered) return;
  answered = true;
  stopTimer();
  disableAnswers();
  
  const chosenOrig = Number(el.dataset.orig);
  const isCorrect = (chosenOrig === correctIndex);
  if(isCorrect){
    el.classList.add('correct');
    playCorrect(); // FIX: Play sound
    currentScore += 10; correctCount++;
  } else {
    el.classList.add('wrong');
    playWrong(); // FIX: Play sound
    currentScore -= 5; wrongCount++;
    Array.from(document.getElementById('answersBox').children).forEach(ch=>{
      if(Number(ch.dataset.orig) === correctIndex) ch.classList.add('correct');
    });
  }
  document.getElementById('scoreVal').textContent = currentScore;
  updateLevelBadge(currentScore);
  
  setTimeout(()=> goNext(), 900);
}

skipBtn.addEventListener('click', ()=>{
  if(!currentSection || answered) return;
  answered = true;
  stopTimer();
  disableAnswers();
  const item = QUIZZES[currentSection].items[currentIndex];
  const correctIndex = item.answerIndex;
  // Show correct answer (No score change on skip)
  Array.from(document.getElementById('answersBox').children).forEach(ch=>{
    if(Number(ch.dataset.orig) === correctIndex) ch.classList.add('correct');
  });
  setTimeout(()=> goNext(),700);
});

function goNext(){
  stopTimer();
  const total = QUIZZES[currentSection].items.length;
  currentIndex++;
  if(currentIndex < total){
    showQuestion();
  } else {
    finishQuiz();
  }
}
function startTimer(){
  let tleft = timerSeconds || 30;
  document.getElementById('timerLabel').textContent = formatTime(tleft);
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    tleft--;
    document.getElementById('timerLabel').textContent = formatTime(tleft);
    if(tleft<=0){
      clearInterval(timerInterval);
      if(!answered){
        answered = true;
        disableAnswers();
        playWrong(); // Indicate time ran out
        
        // No score change, act as skipped
        
        const item = QUIZZES[currentSection].items[currentIndex];
        const corr = item.answerIndex;
        Array.from(document.getElementById('answersBox').children).forEach(ch=>{
          if(Number(ch.dataset.orig) === corr) ch.classList.add('correct');
        });
        setTimeout(()=> goNext(),900); // FIX: Move to next Q without wrong penalty
      }
    }
  },1000);
}
function stopTimer(){ if(timerInterval) clearInterval(timerInterval); timerInterval = null; }

function finishQuiz(){
  quizArea.style.display = 'none';
  stopTimer();

  const totalQuestions = QUIZZES[currentSection].items.length;
  const previousHigh = userData.completedQuizzes[currentSection] || 0;
  let scoreGained = 0;
  
  if (currentScore > previousHigh) {
    scoreGained = currentScore - previousHigh;
    userData.totalScore += scoreGained;
    userData.completedQuizzes[currentSection] = currentScore;
  }
  
  const badgeData = BADGE_CONFIG[currentSection];
  if (currentScore >= badgeData.required_score && !userData.badges.includes(currentSection)) {
      userData.badges.push(currentSection);
      // NOTE: Consider showing badge win in the modal in a real app
  }
  saveUserData();
  
  const sectionTitle = lang === 'ar' ? QUIZZES[currentSection].title_ar : QUIZZES[currentSection].title_en;
  const level = getUserLevel().current;
  
  document.getElementById('resScore').textContent = `${currentScore} Ù†Ù‚Ø·Ø©`;
  document.getElementById('resTitle').textContent = (lang==='ar'?'Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©':'Final Result') + ` â€” ${lang === 'ar' ? level.name_ar : level.name_en}`;
  document.getElementById('resDetails').innerHTML = `
    <div class="small-muted">${lang==='ar'?'Ø§Ù„Ù‚Ø³Ù…':'Section'}: ${sectionTitle.replace(/[\uD800-\uDBFF\uDC00-\uDFFF]/g, '').trim()}</div>
    <div style="margin-top:8px">${lang==='ar'?'Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© Ø§Ù„Ø¢Ù†':'Score Gained Now'}: <strong>${scoreGained}</strong></div>
    <div style="margin-top:8px">${lang==='ar'?'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©':'Correct'}: <strong>${correctCount}/${totalQuestions}</strong></div>
  `;
  
  document.getElementById('savedNote').textContent = LANGS[lang].savedNote;
  document.getElementById('resultModal').style.display = 'flex';
  
  renderPage('missions');
}

// --- Event Listeners ---
document.getElementById('retryBtn').addEventListener('click', ()=> { document.getElementById('resultModal').style.display='none'; startSection(currentSection); });
closeResBtn.addEventListener('click', ()=> { document.getElementById('resultModal').style.display='none'; renderPage('missions'); });
document.querySelector('.start-mission-btn').addEventListener('click', () => { renderPage('missions'); });
document.getElementById('backToMenu').addEventListener('click', () => { renderPage('missions'); });

// FIX: Link Hero button to Learn page
document.querySelector('#page-home .hero-actions .btn:nth-child(2)').addEventListener('click', () => { renderPage('learn'); });


// --- Toggle Dark/Light Mode ---
modeToggleBtn.addEventListener('click', () => {
    document.body.classList.toggle('light');
    const isLight = document.body.classList.contains('light');
    modeToggleBtn.textContent = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
    localStorage.setItem('geo_mode', isLight ? 'light' : 'dark');
});

// --- Language Toggle ---
langToggle.addEventListener('click', () => {
    lang = (lang === 'ar') ? 'en' : 'ar';
    localStorage.setItem('geo_lang', lang);
    document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';
    refreshLangUI();
    const currentPage = Array.from(document.querySelectorAll('.page-wrapper')).find(el => el.style.display !== 'none')?.id.replace('page-', '') || 'home';
    renderPage(currentPage);
});
document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';

// --- Init ---
function init(){
  loadUserData();
  
  const savedMode = localStorage.getItem('geo_mode');
  if (savedMode === 'light') {
      document.body.classList.add('light');
      modeToggleBtn.textContent = 'â˜€ï¸';
  } else if (savedMode === null && window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
     document.body.classList.add('light');
     modeToggleBtn.textContent = 'â˜€ï¸';
  }
  
  refreshLangUI();
  renderPage('home');
}
init();
</script>
</body>
</html>
